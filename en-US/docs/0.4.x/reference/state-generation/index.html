<!DOCTYPE html>
<html class="light"><head><base href="https://framesurge.sh/perseus/" />
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="stylesheet" href=".perseus/static/tailwind.css"/><link rel="stylesheet" href=".perseus/static/styles/style.css"/>
            <script type="module">window.__PERSEUS_RENDER_CFG = `{"docs/next/fundamentals/routing":"docs","docs/reference/deploying/serverful":"docs","docs/0.3.4/reference/state/hsr":"docs","docs/0.1.x/strategies/revalidation":"docs","docs/0.3.4/tutorials/auth":"docs","docs/advanced/subsequent-loads":"docs","docs/reference/stores":"docs","docs/0.3.4/intro":"docs","docs/0.1.x/setup":"docs","docs/0.3.0-0.3.3/strategies/revalidation":"docs","docs/0.3.4/reference/templates/metadata-modification":"docs","docs/reference/views":"docs","docs/0.2.x/i18n/using":"docs","docs/reference/strategies/amalgamation":"docs","docs/next/fundamentals/hydration":"docs","docs/0.3.0-0.3.3/testing/manual":"docs","docs/0.2.x/i18n/defining":"docs","docs/next/fundamentals/styling":"docs","docs/0.3.0-0.3.3/views":"docs","docs/reference/testing/intro":"docs","docs/0.2.x/advanced/routing":"docs","docs/0.1.x/error_pages":"docs","docs/reference/plugins/security":"docs","docs/0.3.4/reference/i18n/other-engines":"docs","docs/reference/deploying/intro":"docs","docs/0.2.x/testing/fantoccini-basics":"docs","docs/0.2.x/strategies/revalidation":"docs","docs/0.3.4/reference/testing/intro":"docs","docs/next/reference/compilation-times":"docs","docs/0.3.0-0.3.3/i18n/translations-managers":"docs","docs/next/fundamentals/perseus-app":"docs","docs/0.2.x/hello-world":"docs","docs/next/fundamentals/i18n":"docs","docs/0.2.x/testing/manual":"docs","docs/0.3.0-0.3.3/hydration":"docs","docs/reference/state/freezing":"docs","docs/0.3.4/reference/stores":"docs","docs/reference/static-content":"docs","docs/0.3.0-0.3.3/what-is-perseus":"docs","docs/0.1.x/templates":"docs","docs/0.3.4/reference/plugins/using":"docs","docs/0.2.x/i18n/translations-managers":"docs","docs/next/fundamentals/preloading":"docs","docs/0.3.0-0.3.3/plugins/using":"docs","docs/reference/plugins/writing":"docs","docs/0.3.4/what-is-perseus":"docs","docs/reference/state/idb-freezing":"docs","docs/reference/define-app":"docs","docs/tutorials/second-app":"docs","docs/next/reference/faq":"docs","docs/0.3.0-0.3.3/deploying/serverless":"docs","docs/0.3.4/reference/strategies/request-state":"docs","docs/advanced/initial-loads":"docs","docs/reference/strategies/incremental":"docs","docs/reference/styling":"docs","docs/0.1.x/cli":"docs","docs/0.3.0-0.3.3/debugging":"docs","docs/reference/plugins/functional":"docs","comparisons":"comparisons","docs/0.3.4/reference/deploying/docker":"docs","docs/0.3.0-0.3.3/advanced/intro":"docs","docs/next/first-app/generating-pages":"docs","docs/reference/plugins/intro":"docs","docs/0.2.x/strategies/build-paths":"docs","docs/0.3.4/advanced/route-announcer":"docs","docs/reference/i18n/intro":"docs","docs/0.3.4/reference/i18n/translations-managers":"docs","docs/next/reference/router":"docs","docs/reference/hydration":"docs","docs/0.2.x/testing/checkpoints":"docs","docs/0.3.0-0.3.3/styling":"docs","docs/0.1.x/routing":"docs","docs/0.3.0-0.3.3/plugins/control":"docs","docs/0.4.x/reference/deploying":"docs","docs/0.3.4/reference/deploying/size":"docs","docs/0.3.4/reference/plugins/functional":"docs","docs/advanced/arch":"docs","docs/reference/snooping":"docs","docs/0.3.0-0.3.3/i18n/other-engines":"docs","docs/0.3.4/reference/strategies/intro":"docs","docs/0.3.4/reference/debugging":"docs","docs/0.3.4/reference/deploying/serverless":"docs","docs/0.3.0-0.3.3/strategies/intro":"docs","docs/reference/state/hsr":"docs","docs/0.3.4/reference/plugins/tinker":"docs","docs/advanced/intro":"docs","docs/reference/i18n/using":"docs","docs/reference/server-communication":"docs","docs/next/first-app/error-handling":"docs","docs/advanced/route-announcer":"docs","docs/0.3.4/core-principles":"docs","docs/0.3.4/reference/i18n/defining":"docs","docs/0.4.x/reference/router":"docs","docs/0.1.x/tutorials/first_app/template":"docs","docs/0.3.4/reference/ejecting":"docs","docs/reference/i18n/translations-managers":"docs","docs/0.1.x/tutorials/first_app/intro":"docs","docs/next/fundamentals/static-content":"docs","docs/0.3.0-0.3.3/testing/fantoccini-basics":"docs","docs/0.3.4/reference/strategies/build-state":"docs","docs/reference/perseus-app":"docs","docs/0.3.0-0.3.3/strategies/request-state":"docs","docs/0.2.x/advanced/arch":"docs","docs/next/first-app/dev-cycle":"docs","docs/0.3.4/reference/i18n/intro":"docs","docs/0.2.x/intro":"docs","docs/0.3.4/reference/cli":"docs","docs/0.3.0-0.3.3/plugins/publishing":"docs","docs/0.3.4/reference/deploying/intro":"docs","docs/0.3.4/reference/define-app":"docs","docs/0.2.x/strategies/intro":"docs","docs/next/reference/deploying":"docs","docs/0.1.x/strategies/incremental":"docs","docs/0.3.0-0.3.3/exporting":"docs","docs/0.3.4/reference/templates/setting-headers":"docs","docs/0.1.x/strategies/request_state":"docs","docs/0.3.0-0.3.3/deploying/relative-paths":"docs","docs/0.3.4/reference/server-communication":"docs","docs/0.3.0-0.3.3/i18n/using":"docs","docs/0.3.4/reference/live-reloading":"docs","docs/next/reference/plugins":"docs","docs/0.1.x/strategies/build_paths":"docs","docs/next/reference/initial_subsequent_loads":"docs","docs/0.2.x/i18n/other-engines":"docs","docs/0.1.x/building":"docs","docs/advanced/routing":"docs","docs/0.2.x/advanced/subsequent-loads":"docs","docs/0.3.0-0.3.3/ejecting":"docs","docs/reference/strategies/build-paths":"docs","docs/0.3.4/reference/state/idb-freezing":"docs","docs/next/state/incremental":"docs","docs/next/reference/migrating":"docs","docs/reference/ejecting":"docs","docs/0.4.x/reference/hydration":"docs","docs/next/first-app/deploying":"docs","docs/next/fundamentals/js-interop":"docs","docs/next/state/revalidation":"docs","docs/0.3.0-0.3.3/second-app":"docs","docs/next/reference/state-platform":"docs","docs/next/reference/state-generation":"docs","docs/0.3.4/advanced/subsequent-loads":"docs","docs/0.3.4/reference/exporting":"docs","docs/0.2.x/error-pages":"docs","docs/next/state/request":"docs","docs/0.1.x/strategies/build_state":"docs","docs/reference/deploying/serverless":"docs","docs/0.2.x/cli":"docs","docs/0.4.x/features":"docs","docs/next/what-is-perseus":"docs","docs/0.3.4/reference/strategies/revalidation":"docs","docs/reference/deploying/size":"docs","docs/0.4.x/reference/compilation-times":"docs","docs/0.2.x/debugging":"docs","docs":"docs","docs/reference/templates/metadata-modification":"docs","docs/reference/strategies/request-state":"docs","docs/reference/updating":"docs","docs/0.3.4/advanced/initial-loads":"docs","docs/0.3.0-0.3.3/intro":"docs","docs/0.3.4/reference/plugins/intro":"docs","docs/0.4.x/reference/plugins":"docs","docs/0.3.4/reference/state/freezing":"docs","docs/0.4.x/reference/state-generation":"docs","docs/0.3.4/reference/pitfalls-and-bugs":"docs","docs/0.3.0-0.3.3/i18n/defining":"docs","docs/next/core-principles":"docs","docs/0.3.0-0.3.3/updating":"docs","plugins":"plugins","docs/0.4.x/reference/exporting":"docs","docs/0.4.x/core-principles":"docs","docs/0.2.x/strategies/amalgamation":"docs","docs/0.3.4/reference/strategies/incremental":"docs","docs/reference/i18n/defining":"docs","docs/next/reference/i18n":"docs","docs/next/reference/exporting":"docs","docs/0.3.0-0.3.3/plugins/intro":"docs","docs/0.3.0-0.3.3/strategies/amalgamation":"docs","docs/next/state/browser":"docs","docs/0.3.0-0.3.3/templates/metadata-modification":"docs","docs/0.3.4/reference/styling":"docs","docs/next/intro":"docs","docs/0.1.x/strategies/intro":"docs","docs/0.4.x/reference/initial_subsequent_loads":"docs","docs/0.2.x/advanced/initial-loads":"docs","docs/0.3.4/reference/deploying/relative-paths":"docs","docs/0.3.0-0.3.3/plugins/writing":"docs","docs/0.3.4/reference/templates/router-state":"docs","docs/0.3.0-0.3.3/hello-world":"docs","docs/0.2.x/templates/metadata-modification":"docs","docs/0.3.4/reference/engines":"docs","docs/0.3.4/reference/plugins/control":"docs","docs/0.4.x/reference/architecture":"docs","docs/what-is-perseus":"docs","docs/0.3.4/reference/testing/fantoccini-basics":"docs","docs/0.2.x/what-is-perseus":"docs","docs/next/quickstart":"docs","docs/next/reference/architecture":"docs","docs/0.2.x/advanced/intro":"docs","docs/0.2.x/strategies/request-state":"docs","docs/0.3.0-0.3.3/testing/intro":"docs","docs/0.3.4/reference/state/global":"docs","docs/next/state/helper":"docs","docs/reference/pitfalls-and-bugs":"docs","docs/reference/deploying/relative-paths":"docs","docs/next/fundamentals/debugging":"docs","docs/0.3.4/reference/testing/manual":"docs","docs/tutorials/hello-world":"docs","docs/0.3.0-0.3.3/templates/setting-headers":"docs","docs/0.2.x/define-app":"docs","docs/0.2.x/deploying/exporting":"docs","docs/0.3.4/reference/plugins/security":"docs","docs/0.3.0-0.3.3/strategies/build-state":"docs","docs/reference/engines":"docs","docs/tutorials/auth":"docs","docs/reference/cli":"docs","docs/0.3.4/reference/index-view":"docs","docs/0.4.x/reference/state-platform":"docs","docs/0.4.x/what-is-perseus":"docs","docs/0.3.4/reference/updating":"docs","docs/0.3.4/reference/strategies/build-paths":"docs","docs/0.3.0-0.3.3/templates/intro":"docs","docs/reference/testing/checkpoints":"docs","docs/next/state/suspense":"docs","docs/reference/testing/manual":"docs","docs/0.4.x/reference/migrating":"docs","docs/0.3.0-0.3.3/testing/checkpoints":"docs","docs/0.3.0-0.3.3/static-content":"docs","docs/0.2.x/views":"docs","docs/0.2.x/deploying/intro":"docs","docs/reference/strategies/intro":"docs","docs/reference/exporting":"docs","docs/0.3.4/reference/i18n/using":"docs","docs/0.2.x/i18n/intro":"docs","docs/0.3.4/advanced/arch":"docs","docs/0.1.x/arch":"docs","docs/reference/plugins/control":"docs","docs/reference/strategies/build-state":"docs","docs/reference/index-view":"docs","docs/0.3.0-0.3.3/deploying/serverful":"docs","docs/0.3.0-0.3.3/deploying/docker":"docs","docs/0.3.4/reference/templates/intro":"docs","docs/reference/testing/fantoccini-basics":"docs","docs/0.4.x/reference/i18n":"docs","docs/0.3.4/reference/deploying/serverful":"docs","docs/next/first-app/defining":"docs","docs/next/first-app/installation":"docs","docs/reference/state/rx":"docs","docs/0.3.4/tutorials/second-app":"docs","docs/0.3.0-0.3.3/server-communication":"docs","docs/0.2.x/strategies/build-state":"docs","docs/0.2.x/strategies/incremental":"docs","docs/0.3.4/tutorials/hello-world":"docs","docs/0.2.x/templates/intro":"docs","docs/0.2.x/ejecting":"docs","docs/0.3.4/advanced/intro":"docs","docs/reference/plugins/tinker":"docs","docs/0.4.x/reference/live-reloading-and-hsr":"docs","docs/reference/error-pages":"docs","docs/next/state/global":"docs","docs/0.2.x/second-app":"docs","docs/0.3.0-0.3.3/advanced/arch":"docs","docs/0.3.4/reference/hydration":"docs","docs/0.1.x/intro":"docs","docs/next/state/build":"docs","docs/0.3.0-0.3.3/advanced/subsequent-loads":"docs","docs/0.2.x/config-managers":"docs","docs/0.3.0-0.3.3/deploying/intro":"docs","docs/0.3.4/reference/snooping":"docs","docs/next/fundamentals/plugins":"docs","docs/reference/strategies/revalidation":"docs","docs/0.3.0-0.3.3/cli":"docs","docs/next/fundamentals/reactor":"docs","docs/next/reference/live-reloading-and-hsr":"docs","docs/0.3.4/reference/error-pages":"docs","docs/0.3.0-0.3.3/advanced/define_app":"docs","docs/reference/templates/setting-headers":"docs","docs/0.3.0-0.3.3/advanced/initial-loads":"docs","docs/reference/state/global":"docs","docs/next/fundamentals/error-views":"docs","docs/0.2.x/updating":"docs","docs/0.1.x/config_managers":"docs","docs/reference/live-reloading":"docs","docs/reference/plugins/using":"docs","docs/reference/deploying/docker":"docs","docs/next/fundamentals/serving-exporting":"docs","docs/0.2.x/static-content":"docs","docs/0.3.0-0.3.3/plugins/tinker":"docs","docs/reference/i18n/other-engines":"docs","docs/0.3.0-0.3.3/error-pages":"docs","":"","docs/0.3.0-0.3.3/strategies/build-paths":"docs","docs/0.3.4/reference/state/rx":"docs","docs/0.3.0-0.3.3/plugins/security":"docs","docs/0.3.0-0.3.3/snooping":"docs","docs/0.4.x/intro":"docs","docs/0.2.x/testing/intro":"docs","docs/0.4.x/reference/faq":"docs","docs/next/reference/hydration":"docs","docs/0.3.4/reference/plugins/publishing":"docs","docs/reference/debugging":"docs","docs/0.3.0-0.3.3/plugins/functional":"docs","docs/0.2.x/styling":"docs","docs/0.3.0-0.3.3/stores":"docs","docs/reference/templates/router-state":"docs","docs/intro":"docs","docs/0.3.0-0.3.3/deploying/size":"docs","docs/0.3.0-0.3.3/strategies/incremental":"docs","docs/0.1.x/tutorials/first_app/app":"docs","docs/0.3.0-0.3.3/i18n/intro":"docs","docs/reference/templates/intro":"docs","docs/0.1.x/integrations/actix-web":"docs","docs/0.3.4/reference/perseus-app":"docs","docs/0.3.0-0.3.3/pitfalls-and-bugs":"docs","docs/0.3.4/reference/testing/checkpoints":"docs","docs/0.3.0-0.3.3/define-app":"docs","docs/0.2.x/templates/setting-headers":"docs","docs/0.1.x/tutorials/first_app/setup":"docs","docs/reference/plugins/publishing":"docs","docs/0.3.0-0.3.3/advanced/routing":"docs","docs/next/fundamentals/testing":"docs","docs/0.3.4/reference/views":"docs","docs/0.3.4/reference/strategies/amalgamation":"docs","docs/core-principles":"docs","docs/next/state/intro":"docs","docs/0.3.4/advanced/routing":"docs","docs/0.3.4/reference/static-content":"docs","docs/0.1.x/serving":"docs","docs/0.3.4/reference/plugins/writing":"docs"}`;

        import init from "https://framesurge.sh/perseus/.perseus/bundle.js";
        async function main() {
            await init("https://framesurge.sh/perseus/.perseus/bundle.wasm");
        }
        main();

        
        

window.__PERSEUS_GLOBAL_STATE = `null`;</script>
            <meta itemprop="__perseus_head_boundary" content="">
            
<title>State Generation | Perseus Docs</title><link rel="stylesheet" href=".perseus/static/styles/markdown.css"/><link rel="stylesheet" href=".perseus/static/styles/docs_links_markdown.css"/><link rel="stylesheet" href=".perseus/static/prism.css"/>
            <script>
window.__PERSEUS_INITIAL_STATE = `{"content":"<h1>State Generation</h1>\\n<p>One of the most important features of Perseus is its state platform, as explained <a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/core-principles\\">here</a>. However, for state to be of any use, you need a way to generate it. Perseus supports <em>many</em> ways of doing this: at build-time, at request-time, or several mixes of the two. This page will outline each of the possible state generation strategies.</p>\\n<h2>Build State</h2>\\n<p>The <em>build state</em> strategy is very simple: provide a function to a <a href=\\"https://docs.rs/perseus/0.4.0-beta/perseus/struct.Template.html\\"><code>Template</code></a> and it will be run when you build your app. Its output will then be used as state!</p>\\n<p>To take a simple example, let's say you have a (very contrived) page that should display the number of entries in a database at the time it was built. You would make a template for this, perhaps called <code>entries</code> (so it would be hosted at <code>/entries</code> on your site), and you'd provide a simple view that calls on some state, which would only need a single property for the number of entries in the DB. Then, just show that!</p>\\n<p>To make this work though, we need to execute some logic at build-time, which we can do with <em>build state</em>! By calling the <code>.build_state_fn()</code> method on <a href=\\"struct.Template@perseus\\"><code>Template</code></a> and providing a function annotated with <code>#[perseus::build_state]</code>, that function will be called when the template is built, and its output will be used to provide the initial value of the state.</p>\\n<p>We should clarify at this point that the 'initial value' of the state is what's generated <em>before</em> it arrives in the browser. Then, it can be changed in the browser (e.g. a default value for an input generated at build-time that the user can change by typing in it), but any such changes will only impact that single browser. Changing the future value of the state involves <em>revalidation</em>, described below.</p>\\n<p>A <em>build state</em> function takes two parameters: the path (see below) and the locale it's being built for. (You might use the locale if you're working with <a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/i18n\\">i18n</a> to fetch some language-specific data.) It will then return a <a href=\\"https://docs.rs/perseus/0.4.0-beta/perseus/type.RenderFnResultWithCause.html\\"><code>RenderFnResultWithCause&lt;State&gt;</code></a>, where <code>State</code> is your state type.</p>\\n<h2>Build Paths</h2>\\n<p>But now, let's say we actually have multiple tables in our database, and we want to know how many entries are in each one, with each count being displayed on a different page. Really, we want several pages under that <code>/entries</code> path now. This is easily achievable with <em>build paths</em>, which allows a single template to generate many pages.</p>\\n<p>By providing a function to the <code>.build_paths_fn()</code> method of <a href=\\"https://docs.rs/perseus/0.4.0-beta/perseus/struct.Template.html\\"><code>Template</code></a>, that will be called at build-time to generate a <code>Vec&lt;String&gt;</code> of paths underneath <code>/entries</code>. For instant, if we returned <code>vec![ &quot;foo&quot;.to_string(), &quot;bar&quot;.to_string(), &quot;baz&quot;.to_string() ]</code>, Perseus would create pages at <code>/entries/foo</code>, <code>/entires/bar</code>, and <code>/entries/baz</code>. If you wanted to create an <code>/entries</code> page, you would provide an empty string as one of the elements in that <code>Vec&lt;String&gt;</code>.</p>\\n<p>Note that you can also create nested paths like <code>foo/bar/baz</code> just like that.</p>\\n<p>So, in our example, we would query our database for each of its tables, and then return a vector off their names, and Perseus would then generate a page for each, all from that same template!</p>\\n<p>However, this is absolutely pointless without <em>build state</em> as well, since each of those pages would be the same right now. Usefully, as you may have noticed, the <em>build state</em> function takes its first parameter as the path, which is designed for working with <em>build paths</em>! So, in this case, of <code>foo</code>, <code>bar</code>, and <code>baz</code>, the provided <em>build state</em> function would be run three times, once with <code>entries/foo</code>, then with <code>entries/bar</code>, and finally with <code>entries/baz</code>. Notably, these runs will happen concurrently, speeding everything up! You can then use that given path to know which table's entry count to check. By making your <em>build state</em> function 'generic' in this way over the path it's given, which is representative here of the database table to fetch a count from, you can easily display many pages with different information, all from the same template!</p>\\n<p>A <em>build paths</em> function takes no arguments, and returns a <a href=\\"https://docs.rs/perseus/0.4.0-beta/perseus/type.RenderFnResult.html\\"><code>RenderFnResult&lt;Vec&lt;String&gt;&gt;</code></a>.</p>\\n<h2>Request State</h2>\\n<p>However, what if we only wanted to show the counts to certain people? Let's say authorized users will have a cookie in their browser that we can check somehow, and only they should be allowed to view these counts.</p>\\n<p>We could use <em>request state</em> to run a function provided to the <code>.request_state_fn()</code> method of <a href=\\"https://docs.rs/perseus/0.4.0-beta/perseus/struct.Template.html\\"><code>Template</code></a> when a user's request comes in for that page. Unlike the build-time functions, the logic in here has to be very quick, otherwise we'll slow down the page load and reduce the performance of our site.</p>\\n<p>Usefully, a <em>request state</em> function is given the <a href=\\"https://docs.rs/perseus/0.4.0-beta/perseus/struct.Request.html\\"><code>Request</code></a> from the user's request, which allows access to cookies, etc. With that, we can check if the user has our authentication cookie and make sure that it's valid, and then return a <code>None</code> for the count (which would now have to be an <code>Option&lt;u32&gt;</code>, see the next section) and <code>false</code> for a new <code>authorized</code> property.</p>\\n<p>A <em>request state</em> function takes three arguments: the path, the locale it's being built for, and the user's request. It then returns a <a href=\\"https://docs.rs/perseus/0.4.0-beta/perseus/type.RenderFnResultWithCause.html\\"><code>RenderFnResultWithCause&lt;State&gt;</code></a>, where <code>State</code> is your state type.</p>\\n<h2>Amalgamate States</h2>\\n<p>However, there's a problem with the above idea in most frameworks that support build state and request state, or similar principles. You can only usually use one, since otherwise the build state and the request state might generate conflicting states! This is exactly what would happen here: the build state would happily get the count, and the request state would always override this as <code>None</code>, authorized or not, and it would set <code>authorized</code>, which the build state might always assume to be <code>true</code>. Whatever shall we do?</p>\\n<p>The answer to this is dead simple: the <em>state amalgamation</em> strategy, which allows us to take in both of those states and do some arbitrary stuff to resolve them. In this case, based on the value of <code>authorized</code> property from the <em>request state</em>, we would either return <code>authorized: false, state: None</code>, or <code>authorized: true, state: Some(state)</code>, where <code>state</code> in the latter comes from the <em>build state</em> function. Nifty, eh?</p>\\n<p>Note though that you won't always need state amalgamation, it's mostly useful for adding this kind of authentication to pages that already have build state, allowing you to get the best optimizations and the best security!</p>\\n<p>A <em>state amalgamation</em> function takes four arguments: the path, the locale it's being built for, the build state, and the request state (both unreactive). It then returns a <a href=\\"https://docs.rs/perseus/0.4.0-beta/perseus/type.RenderFnResultWithCause.html\\"><code>RenderFnResultWithCause&lt;State&gt;</code></a>, where <code>State</code> is your state type.</p>\\n<h2>Revalidation</h2>\\n<p>Now, what if we wanted to make that count a little more up to date? Say, we should update it daily. Perseus makes this trivial, you just use the <code>.revalidate_after</code> method on <a href=\\"https://docs.rs/perseus/0.4.0-beta/perseus/struct.Template.html\\"><code>Template</code></a> to define an interval, and, every time a new request comes in, if more than that interval has elapsed, then the <em>build state</em> function will be re-run.</p>\\n<p>Alternatively, you might want to perform some logic first to check if the state should be revalidated or not: use <code>.should_revalidate_fn()</code> on <a href=\\"https://docs.rs/perseus/0.4.0-beta/perseus/struct.Template.html\\"><code>Template</code></a> to provide the function that does this.</p>\\n<p>Note that you can use both time-based <em>and</em> logic-based revalidation on the same template if you want to: the logic-based one will only run if the time-based one tells it to.</p>\\n<p><em>Note: if you use revalidation on a template with many pages, revalidation will be performed piecemeal, page-by-page, as each is requested.</em></p>\\n<p>A <em>logic-based revalidation</em> function (provided to <code>.should_revalidate.fn()</code>) takes three arguments: the path, the locale it's being built for, and the user's request. It then returns a <code>bool</code>. The reason the build-time/request-time states are not available is due to the structure of the internal render algorithms, and practicalities: anything needed from the request state can be re-derived from the user's request, and the build state can't be used for checking if a page should revalidate, since it's always going to be the same.</p>\\n<h2>Incremental Generation</h2>\\n<p>Finally, let's say your database is getting a little out of hand, with new tables popping up every other day. You don't want to constantly have to be rebuilding your whole app for each new table!</p>\\n<p>In this case, you would want to call <code>.incremental_generation()</code> on <a href=\\"https://docs.rs/perseus/0.4.0-beta/perseus/struct.Template.html\\"><code>Template</code></a>, which opens the floodgates, so to speak! Essentially, if we still have our three pages from before (i.e. <code>/entries/foo</code>, <code>/entries/bar</code>, and <code>/entries/baz</code>), and the user goes to <code>/entries/test</code>, rather than sending a <em>404 Not Found</em> error, the Perseus server will run the <em>build state</em> function for this path (<code>entries/test</code>), and it will build for that database table at request-time! Even better, if this all works, it'll cache the results for next time, meaning it can serve <code>/entries/test</code> instantly next time!</p>\\n<p>As you can imagine, this is <em>extremely</em> useful for templates that render millions, or even billions of pages, since you can build them dynamically and cache them for performance at runtime, rather than spending hours building all of them.</p>\\n<p>And <em>this</em> is why you the <em>build state</em> function returns a <a href=\\"https://docs.rs/perseus/0.4.0-beta/perseus/type.RenderFnResultWithCause.html\\"><code>RenderFnResultWithCause</code></a>, because you can <em>blame</em> either the client or the server. Without incremental generation, you know you'll only get those paths you defined in the <em>build paths</em> function, but, with incremental generation, you could get anything. If you know there's one table, say <code>admin</code>, that you should never serve a count for, you can add an if-statement to the top of your <em>build state</em> function that checks if the <code>path</code> argument is <code>entries/admin</code>, and returns a <em>404 Not Found</em> error, blaming the client, and they'll be none the wiser!</p>\\n<p><em>Note: in applications using both build paths and incremental generation, those paths defined by the build paths function will be rendered at build-time, while any more that aren't defined there will be rendered dynamically upon request.</em></p>\\n<h2>Examples</h2>\\n<p>Some of this may be a little tricky to visualize, so there's an example <a href=\\"https://github.com/artic-hen7/perseus/tree/main/examples/core/state_generation\\">here</a> that goes through each of Perseus' state generation strategies systematically! Note that it doesn't use the same example of a database entry counter as described here, but rather more basic examples to just show the basic functionality of each strategy. Enjoy!</p>\\n","current_version":"0.4.x","manifest":{"0.1.x":{"docs_rs":"0.1","git":"v0.1.4","state":"outdated"},"0.2.x":{"docs_rs":"0.2","git":"v0.2.3","state":"outdated"},"0.3.0-0.3.3":{"docs_rs":"0.3.3","git":"v0.3.3","state":"outdated"},"0.3.4":{"docs_rs":"0.3","git":"v0.3.6","state":"stable"},"0.4.x":{"docs_rs":"0.4.0-beta","git":"HEAD","state":"beta"}},"sidebar_content":"<h1>Introduction</h1>\\n<ul>\\n<li><a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/intro\\">Introduction</a></li>\\n<li><a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/what-is-perseus\\">What is Perseus?</a></li>\\n<li><a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/core-principles\\">Core Principles</a></li>\\n</ul>\\n<h1>Reference</h1>\\n<ul>\\n<li><a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/features\\">Feature Discovery Terminal</a></li>\\n<li><a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/compilation-times\\">Improving Compilation Times</a></li>\\n<li><a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/state-platform\\">State Platform</a></li>\\n<li><a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/state-generation\\">State Generation</a></li>\\n<li><a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/live-reloading-and-hsr\\">Live Reloading and HSR</a></li>\\n<li><a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/i18n\\">Internationalization</a></li>\\n<li><a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/hydration\\">Hydration</a></li>\\n<li><a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/exporting\\">Static Exporting</a></li>\\n<li><a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/plugins\\">Plugins</a></li>\\n<li><a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/deploying\\">Deploying</a></li>\\n<li><a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/architecture\\">Architecture Details</a></li>\\n<li><a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/router\\">Router</a></li>\\n<li><a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/initial_subsequent_loads\\">Initial vs. Subsequent Loads</a></li>\\n<li><a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/migrating\\">Migrating from v0.3.x</a></li>\\n<li><a href=\\"https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/faq\\">Common Pitfalls and Known Bugs</a></li>\\n</ul>\\n","status":"Beta","title":"State Generation"}`;
window.__PERSEUS_INITIAL_WIDGET_STATES = `{}`;
window.__PERSEUS_TRANSLATIONS = `{
    "perseus": "Perseus",
    "sycamore": "Sycamore",
    "navlinks.docs": "Docs",
    "navlinks.comparisons": "Comparisons",
    "navlinks.plugins": "Plugins",
    "index-intro.heading": "The Rust framework for the modern web",
    "index-intro.get-started-button": "Get started now",
    "index-intro.github-button": "GitHub",
    "index-state-gen.heading": "Generate state, on your terms",
    "index-state-gen.desc": "Perseus apps can generate state whenever they like and pass it to <a href=\\"https://github.com/sycamore-rs/sycamore\\" class=\\"underline\\">Sycamore</a>, one of the fastest web frameworks in the world.",
    "index-i18n.heading.start": "I18n",
    "index-i18n.heading.rest": " that just works",
    "index-i18n.heading.tooltip": "Internationalization",
    "index-i18n.desc": "Just add translations using <a href=\\"https://projectfluent.org\\" class=\\"underline\\">Fluent</a>, and your app can be set up in seconds in multiple languages, with automatic user locale detection.",
    "index-opts.heading": "You want options? We got options.",
    "index-opts.desc": "Perseus comes with a built-in plugins system and full customizability of almost every part of the system. Static exporting? Serverful deployment? Fetch data by carrier pigeon? Easy.",
    "index-speed.heading": "Fast. Crazy. Fast.",
    "index-speed.desc-line-1": "Underlying platform? <strong>Rust.</strong>",
    "index-speed.desc-line-2": "Target platform? <strong>WebAssembly.</strong>",
    "index-speed.desc-line-3": "Lighthouse scores? <strong>💯</strong>",
    "index-speed.desktop-perf-label": "Performance (Desktop)",
    "index-speed.mobile-perf-label": "Performance (Mobile)",
    "index-speed.best-practices-label": "Best Practices",
    "index-cta.heading": "Get started with Perseus today!",
    "index-cta.docs-button": "Docs",
    "index-cta.gh-button": "GitHub",
    "index-cta.api-docs-button": "API Docs",
    "index-cta.crates-io-button": "Crates.io",
    "index-cta.matrix-button": "Matrix",
    "index-cta.discord-button": "Discord",
    "index-cta.comparisons-button": "Comparisons",
    "footer.copyright": "© <a href=\\"https://github.com/arctic-hen7\\" class=\\"underline\\">arctic-hen7</a> { $years }, see license <a href=\\"https://github.com/arctic-hen7/perseus/blob/main/LICENSE\\" class=\\"underline\\">here</a>.",
    "comparisons-title": "Comparisons to Other Frameworks",
    "comparisons-heading": "Comparisons",
    "comparisons-subtitle": "See how Perseus compares to other web development frameworks.",
    "comparisons-extra": "Is there anything we're missing here? Please <a href =\\"https://github.com/framesurge/perseus/issues/new/choose\\" class=\\"underline\\">open an issue</a> and let us know!",
    "comparisons-table-header": "Comparison",
    "comparisons-table-headings.name": "Name",
    "comparisons-table-headings.supports_ssg": "Static generation",
    "comparisons-table-headings.supports_ssr": "Server-side rendering",
    "comparisons-table-headings.supports_ssr_ssg_same_page": "SSG & SSR in same page",
    "comparisons-table-headings.supports_i18n": "Internationalization",
    "comparisons-table-headings.supports_incremental": "Incremental generation",
    "comparisons-table-headings.supports_revalidation": "Revalidation",
    "comparisons-table-headings.inbuilt_cli": "Inbuilt CLI",
    "comparisons-table-headings.inbuilt_routing": "Routing support",
    "comparisons-table-headings.supports_shell": "App shell",
    "comparisons-table-headings.supports_deployment": "Easy deployment",
    "comparisons-table-headings.supports_exporting": "Static exporting",
    "comparisons-table-headings.language": "Language",
    "comparisons-table-headings.homepage_lighthouse_desktop": "Homepage Lighthouse Score (Desktop)",
    "comparisons-table-headings.homepage_lighthouse_mobile": "Homepage Lighthouse Score (Mobile)",
    "comparisons-table-details.supports_ssg": "Whether or not the framework supports pre-rendering pages at build-time.",
    "comparisons-table-details.supports_ssr": "Whether or not the framework supports rendering pages dynamically when they're requested.",
    "comparisons-table-details.supports_ssr_ssg_same_page": "Whether or not the framework supports SSG and SSR (see above) in the very same page.",
    "comparisons-table-details.supports_i18n": "Whether or not the framework supports building a multilingual app. Some frameworks support this through plugins.",
    "comparisons-table-details.supports_incremental": "Whether or not the framework supports rendering pages on-demand and then caching them for future use.",
    "comparisons-table-details.supports_revalidation": "Whether or not the framework supports rebuilding pages that were built at build-time at request-time. Some frameworks can do this by time, or by custom logic. Perseus supports both.",
    "comparisons-table-details.inbuilt_cli": "Whether or not the framework has a command-line interface for convenient usage. Some frameworks use third-party CLIs.",
    "comparisons-table-details.inbuilt_routing": "Whether or not the framework supports inbuilt routing. Most frameworks have their own way of doing this if they do support it.",
    "comparisons-table-details.supports_shell": "Whether or not this framework has an app shell, which makes switching pages much faster and cleaner.",
    "comparisons-table-details.supports_deployment": "Whether or not this framework supports easy deployment. Perseus can deploy in one command.",
    "comparisons-table-details.supports_exporting": "Whether or not this framework can operate without a server, as a series of purely static files.",
    "comparisons-table-details.language": "The programming language this framework is built in. (Hint: Rust is the fastest!)",
    "comparisons-table-details.homepage_lighthouse_desktop": "The Lighthouse score out of 100 for desktop (higher is better). These are collected from Google's PageSpeed Insights tool. These are for the framework's website, and may not reflect the performance of all sites made with the framework.",
    "comparisons-table-details.homepage_lighthouse_mobile": "The Lighthouse score out of 100 for mobile (higher is better). These are collected from Google's PageSpeed Insights tool. These are for the framework's website, and may not reflect the performance of all sites made with the framework.",
    "comparisons-sycamore-heading": "Perseus vs Sycamore",
    "comparisons-sycamore-text": "Perseus is a framework that uses Sycamore to write views (the things users see), so there's not much point in comparing the two as competitors. However, Sycamore can be used without Perseus, which works perfectly well, though you'll miss out on features like inbuilt internationalization, static generation (though you could build this yourself), and incremental generation. If you want to build just a bit of your site with Rust, Sycamore is the perfect tool, Perseus is a full framework designed for building entire websites.",
    "comparisons-unknown-heading": "Perseus vs { $name }",
    "docs-title-base": "Perseus Docs",
    "docs-status.outdated": "This version of the documentation is outdated, and features documented here may work differently now. You can see the latest stable version of the docs <a href=\\"en-US/docs/{ $stable }/intro\\" class=\\"underline\\">here</a>.",
    "docs-status.beta": "This version of the documentation is for a version that has only been released in beta, and is not yet stable. Features documented here may not be present in the latest stable version, and they're subject to rapid and drastic change. You can see the latest stable version of the docs <a href=\\"en-US/docs/{ $stable }/intro\\" class=\\"underline\\">here</a>.",
    "docs-status.next": "This version of the documentation is for a version that has not yet been released, and features documented here may not be present in the latest release. You can see the latest stable version of the docs <a href=\\"en-US/docs/{ $stable }/intro\\" class=\\"underline\\">here</a>.",
    "docs-version-switcher.next": "Next (unreleased)",
    "docs-version-switcher.beta": "v{ $version } (beta)",
    "docs-version-switcher.stable": "v{ $version } (stable)",
    "docs-version-switcher.outdated": "v{ $version } (outdated)",
    "plugins-title": "Plugins",
    "plugins-title-full": "Perseus Plugins",
    "plugin-card-author": "By { $author }",
    "plugin-details.repo_link": "Repository:",
    "plugin-details.crates_link": "Crate page:",
    "plugin-details.docs_link": "Docs:",
    "plugin-details.site_link": "Site:",
    "plugin-details.metadata_heading": "Metadata",
    "plugin-details.no_link_text": "N/A",
    "plugin-search.placeholder": "Search",
    "plugin-search.no_results": "No results found.",
    "plugins-desc": "These are all the public plugins for Perseus! If you've made a plugin, and you'd like it to be listed here, please open an issue on our repository!",
    "search": "Search the docs",
    "index-example-switcher.excerpts": "Excerpts",
    "index-example-switcher.full": "Full"
}
`;</script>
            <meta itemprop="__perseus_head_end" content="">
            <script>//</script>
            </head><body class="bg-white dark:bg-neutral-900"><div id="root"><header data-hk="8.0" class="shadow-md sm:p-2 w-full mb-20 bg-neutral-500/30 backdrop-blur-lg text-black dark:text-white"><div data-hk="8.1" class="flex justify-between items-center"><a data-hk="8.2" class="justify-self-start self-center m-3 ml-5 text-md sm:text-2xl text-bold title-font" href="en-US/">Perseus</a><div data-hk="8.3" class="md:hidden m-3 mr-5 tham tham-e-spin tham-w-6 "><div data-hk="8.4" class="tham-box"><div data-hk="8.5" class="tham-inner bg-black dark:bg-white"></div></div></div><nav data-hk="8.6" class="hidden md:flex"><ul data-hk="8.7" class="mr-5 flex"><li data-hk="9.0" class="m-3 p-1 title-font"><a data-hk="9.1" href="en-US/docs" class="px-2">Docs</a></li><li data-hk="9.2" class="m-3 p-1 title-font"><a data-hk="9.3" href="en-US/comparisons" class="px-2">Comparisons</a></li><li data-hk="9.4" class="m-3 p-1 title-font"><a data-hk="9.5" href="en-US/plugins" class="px-2">Plugins</a></li></ul></nav></div><nav data-hk="8.8" id="mobile_nav_menu" class="md:hidden w-full text-center justify-center hidden"><ul data-hk="8.9" class="mr-5"><li data-hk="10.0" class="m-3 p-1 title-font"><a data-hk="10.1" href="en-US/docs" class="px-2">Docs</a></li><li data-hk="10.2" class="m-3 p-1 title-font"><a data-hk="10.3" href="en-US/comparisons" class="px-2">Comparisons</a></li><li data-hk="10.4" class="m-3 p-1 title-font"><a data-hk="10.5" href="en-US/plugins" class="px-2">Plugins</a></li></ul><hr data-hk="2.0"/><div data-hk="2.1" class="text-left p-3 overflow-y-scroll h-[60vh]"><div data-hk="2.2" class="flex w-full justify-center text-center"><div data-hk="2.3" class="max-w-3xl flex flex-col"><!--#--><!----><!--/--><!----><!--#--><!----><select data-hk="4.4" class="p-2 rounded-md text-white bg-indigo-500"><option data-hk="4.5" value="next">Next (unreleased)</option><option data-hk="4.0" value="0.4.x" selected="">v0.4.x (beta)</option><option data-hk="4.6" value="0.3.4">v0.3.4 (stable)</option><option data-hk="4.1" value="0.3.0-0.3.3">v0.3.0-0.3.3 (outdated)</option><option data-hk="4.2" value="0.2.x">v0.2.x (outdated)</option><option data-hk="4.3" value="0.1.x">v0.1.x (outdated)</option></select><!--/--></div></div><div data-hk="2.4" class="docs-links-markdown"><h1>Introduction</h1>
<ul>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/intro">Introduction</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/what-is-perseus">What is Perseus?</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/core-principles">Core Principles</a></li>
</ul>
<h1>Reference</h1>
<ul>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/features">Feature Discovery Terminal</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/compilation-times">Improving Compilation Times</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/state-platform">State Platform</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/state-generation">State Generation</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/live-reloading-and-hsr">Live Reloading and HSR</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/i18n">Internationalization</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/hydration">Hydration</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/exporting">Static Exporting</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/plugins">Plugins</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/deploying">Deploying</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/architecture">Architecture Details</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/router">Router</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/initial_subsequent_loads">Initial vs. Subsequent Loads</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/migrating">Migrating from v0.3.x</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/faq">Common Pitfalls and Known Bugs</a></li>
</ul>
</div></div></nav></header><main data-hk="2.20" id="scroll-container"><div data-hk="2.5" class="flex w-full"><div data-hk="2.6" class="h-screen pt-14 xs:pt-16 sm:pt-20 lg:pt-25 hidden md:block max-w-xs w-full border-r overflow-y-auto"><div data-hk="2.7" class="mr-5"><div data-hk="2.8" class="text-left text-black dark:text-white p-3"><aside data-hk="2.9"><div data-hk="2.10" class="flex flex-col"><!--#--><!----><!--/--><!----><!--#--><!----><select data-hk="6.4" class="p-2 rounded-md text-white bg-indigo-500"><option data-hk="6.5" value="next">Next (unreleased)</option><option data-hk="6.0" value="0.4.x" selected="">v0.4.x (beta)</option><option data-hk="6.6" value="0.3.4">v0.3.4 (stable)</option><option data-hk="6.1" value="0.3.0-0.3.3">v0.3.0-0.3.3 (outdated)</option><option data-hk="6.2" value="0.2.x">v0.2.x (outdated)</option><option data-hk="6.3" value="0.1.x">v0.1.x (outdated)</option></select><!--/--></div><div data-hk="2.11" class="docs-links-markdown"><h1>Introduction</h1>
<ul>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/intro">Introduction</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/what-is-perseus">What is Perseus?</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/core-principles">Core Principles</a></li>
</ul>
<h1>Reference</h1>
<ul>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/features">Feature Discovery Terminal</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/compilation-times">Improving Compilation Times</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/state-platform">State Platform</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/state-generation">State Generation</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/live-reloading-and-hsr">Live Reloading and HSR</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/i18n">Internationalization</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/hydration">Hydration</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/exporting">Static Exporting</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/plugins">Plugins</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/deploying">Deploying</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/architecture">Architecture Details</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/router">Router</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/initial_subsequent_loads">Initial vs. Subsequent Loads</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/migrating">Migrating from v0.3.x</a></li>
<li><a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/faq">Common Pitfalls and Known Bugs</a></li>
</ul>
</div></aside></div></div></div><div data-hk="2.12" class="h-screen pt-14 xs:pt-16 sm:pt-20 lg:pt-25 grid grid-rows-[1fr_min-content] w-full overflow-y-auto"><div data-hk="2.13" class="px-3 w-full sm:mr-auto sm:ml-auto sm:max-w-prose lg:max-w-3xl xl:max-w-4xl 2xl:max-w-5xl min-w-0"><!--#--><div data-hk="2.14" class="ring-4 ring-yellow-300 p-4 rounded-lg mt-1"><div data-hk="2.15" class="flex flex-col 2xs:flex-row dark:text-white"><span data-hk="2.16" class="self-center mr-2" style="fill: #fcd34d;"><svg xmlns="http://www.w3.org/2000/svg" height="auto" viewBox="0 0 24 24" width="2.25rem" fill="\#000000"><path d="M12 5.99L19.53 19H4.47L12 5.99M2.74 18c-.77 1.33.19 3 1.73 3h15.06c1.54 0 2.5-1.67 1.73-3L13.73 4.99c-.77-1.33-2.69-1.33-3.46 0L2.74 18zM11 11v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zm0 5h2v2h-2z"/></svg></span><p data-hk="2.17">This version of the documentation is for a version that has only been released in beta, and is not yet stable. Features documented here may not be present in the latest stable version, and they're subject to rapid and drastic change. You can see the latest stable version of the docs <a href="en-US/docs/0.3.4/intro" class="underline">here</a>.</p></div></div><!--/--><main data-hk="2.18" class="text-black dark:text-white"><div data-hk="1.0" class="markdown min-w-0 pb-10"><h1>State Generation</h1>
<p>One of the most important features of Perseus is its state platform, as explained <a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/core-principles">here</a>. However, for state to be of any use, you need a way to generate it. Perseus supports <em>many</em> ways of doing this: at build-time, at request-time, or several mixes of the two. This page will outline each of the possible state generation strategies.</p>
<h2>Build State</h2>
<p>The <em>build state</em> strategy is very simple: provide a function to a <a href="https://docs.rs/perseus/0.4.0-beta/perseus/struct.Template.html"><code>Template</code></a> and it will be run when you build your app. Its output will then be used as state!</p>
<p>To take a simple example, let's say you have a (very contrived) page that should display the number of entries in a database at the time it was built. You would make a template for this, perhaps called <code>entries</code> (so it would be hosted at <code>/entries</code> on your site), and you'd provide a simple view that calls on some state, which would only need a single property for the number of entries in the DB. Then, just show that!</p>
<p>To make this work though, we need to execute some logic at build-time, which we can do with <em>build state</em>! By calling the <code>.build_state_fn()</code> method on <a href="struct.Template@perseus"><code>Template</code></a> and providing a function annotated with <code>#[perseus::build_state]</code>, that function will be called when the template is built, and its output will be used to provide the initial value of the state.</p>
<p>We should clarify at this point that the 'initial value' of the state is what's generated <em>before</em> it arrives in the browser. Then, it can be changed in the browser (e.g. a default value for an input generated at build-time that the user can change by typing in it), but any such changes will only impact that single browser. Changing the future value of the state involves <em>revalidation</em>, described below.</p>
<p>A <em>build state</em> function takes two parameters: the path (see below) and the locale it's being built for. (You might use the locale if you're working with <a href="https://framesurge.sh/perseus/en-US/docs/0.4.x/reference/i18n">i18n</a> to fetch some language-specific data.) It will then return a <a href="https://docs.rs/perseus/0.4.0-beta/perseus/type.RenderFnResultWithCause.html"><code>RenderFnResultWithCause&lt;State&gt;</code></a>, where <code>State</code> is your state type.</p>
<h2>Build Paths</h2>
<p>But now, let's say we actually have multiple tables in our database, and we want to know how many entries are in each one, with each count being displayed on a different page. Really, we want several pages under that <code>/entries</code> path now. This is easily achievable with <em>build paths</em>, which allows a single template to generate many pages.</p>
<p>By providing a function to the <code>.build_paths_fn()</code> method of <a href="https://docs.rs/perseus/0.4.0-beta/perseus/struct.Template.html"><code>Template</code></a>, that will be called at build-time to generate a <code>Vec&lt;String&gt;</code> of paths underneath <code>/entries</code>. For instant, if we returned <code>vec![ &quot;foo&quot;.to_string(), &quot;bar&quot;.to_string(), &quot;baz&quot;.to_string() ]</code>, Perseus would create pages at <code>/entries/foo</code>, <code>/entires/bar</code>, and <code>/entries/baz</code>. If you wanted to create an <code>/entries</code> page, you would provide an empty string as one of the elements in that <code>Vec&lt;String&gt;</code>.</p>
<p>Note that you can also create nested paths like <code>foo/bar/baz</code> just like that.</p>
<p>So, in our example, we would query our database for each of its tables, and then return a vector off their names, and Perseus would then generate a page for each, all from that same template!</p>
<p>However, this is absolutely pointless without <em>build state</em> as well, since each of those pages would be the same right now. Usefully, as you may have noticed, the <em>build state</em> function takes its first parameter as the path, which is designed for working with <em>build paths</em>! So, in this case, of <code>foo</code>, <code>bar</code>, and <code>baz</code>, the provided <em>build state</em> function would be run three times, once with <code>entries/foo</code>, then with <code>entries/bar</code>, and finally with <code>entries/baz</code>. Notably, these runs will happen concurrently, speeding everything up! You can then use that given path to know which table's entry count to check. By making your <em>build state</em> function 'generic' in this way over the path it's given, which is representative here of the database table to fetch a count from, you can easily display many pages with different information, all from the same template!</p>
<p>A <em>build paths</em> function takes no arguments, and returns a <a href="https://docs.rs/perseus/0.4.0-beta/perseus/type.RenderFnResult.html"><code>RenderFnResult&lt;Vec&lt;String&gt;&gt;</code></a>.</p>
<h2>Request State</h2>
<p>However, what if we only wanted to show the counts to certain people? Let's say authorized users will have a cookie in their browser that we can check somehow, and only they should be allowed to view these counts.</p>
<p>We could use <em>request state</em> to run a function provided to the <code>.request_state_fn()</code> method of <a href="https://docs.rs/perseus/0.4.0-beta/perseus/struct.Template.html"><code>Template</code></a> when a user's request comes in for that page. Unlike the build-time functions, the logic in here has to be very quick, otherwise we'll slow down the page load and reduce the performance of our site.</p>
<p>Usefully, a <em>request state</em> function is given the <a href="https://docs.rs/perseus/0.4.0-beta/perseus/struct.Request.html"><code>Request</code></a> from the user's request, which allows access to cookies, etc. With that, we can check if the user has our authentication cookie and make sure that it's valid, and then return a <code>None</code> for the count (which would now have to be an <code>Option&lt;u32&gt;</code>, see the next section) and <code>false</code> for a new <code>authorized</code> property.</p>
<p>A <em>request state</em> function takes three arguments: the path, the locale it's being built for, and the user's request. It then returns a <a href="https://docs.rs/perseus/0.4.0-beta/perseus/type.RenderFnResultWithCause.html"><code>RenderFnResultWithCause&lt;State&gt;</code></a>, where <code>State</code> is your state type.</p>
<h2>Amalgamate States</h2>
<p>However, there's a problem with the above idea in most frameworks that support build state and request state, or similar principles. You can only usually use one, since otherwise the build state and the request state might generate conflicting states! This is exactly what would happen here: the build state would happily get the count, and the request state would always override this as <code>None</code>, authorized or not, and it would set <code>authorized</code>, which the build state might always assume to be <code>true</code>. Whatever shall we do?</p>
<p>The answer to this is dead simple: the <em>state amalgamation</em> strategy, which allows us to take in both of those states and do some arbitrary stuff to resolve them. In this case, based on the value of <code>authorized</code> property from the <em>request state</em>, we would either return <code>authorized: false, state: None</code>, or <code>authorized: true, state: Some(state)</code>, where <code>state</code> in the latter comes from the <em>build state</em> function. Nifty, eh?</p>
<p>Note though that you won't always need state amalgamation, it's mostly useful for adding this kind of authentication to pages that already have build state, allowing you to get the best optimizations and the best security!</p>
<p>A <em>state amalgamation</em> function takes four arguments: the path, the locale it's being built for, the build state, and the request state (both unreactive). It then returns a <a href="https://docs.rs/perseus/0.4.0-beta/perseus/type.RenderFnResultWithCause.html"><code>RenderFnResultWithCause&lt;State&gt;</code></a>, where <code>State</code> is your state type.</p>
<h2>Revalidation</h2>
<p>Now, what if we wanted to make that count a little more up to date? Say, we should update it daily. Perseus makes this trivial, you just use the <code>.revalidate_after</code> method on <a href="https://docs.rs/perseus/0.4.0-beta/perseus/struct.Template.html"><code>Template</code></a> to define an interval, and, every time a new request comes in, if more than that interval has elapsed, then the <em>build state</em> function will be re-run.</p>
<p>Alternatively, you might want to perform some logic first to check if the state should be revalidated or not: use <code>.should_revalidate_fn()</code> on <a href="https://docs.rs/perseus/0.4.0-beta/perseus/struct.Template.html"><code>Template</code></a> to provide the function that does this.</p>
<p>Note that you can use both time-based <em>and</em> logic-based revalidation on the same template if you want to: the logic-based one will only run if the time-based one tells it to.</p>
<p><em>Note: if you use revalidation on a template with many pages, revalidation will be performed piecemeal, page-by-page, as each is requested.</em></p>
<p>A <em>logic-based revalidation</em> function (provided to <code>.should_revalidate.fn()</code>) takes three arguments: the path, the locale it's being built for, and the user's request. It then returns a <code>bool</code>. The reason the build-time/request-time states are not available is due to the structure of the internal render algorithms, and practicalities: anything needed from the request state can be re-derived from the user's request, and the build state can't be used for checking if a page should revalidate, since it's always going to be the same.</p>
<h2>Incremental Generation</h2>
<p>Finally, let's say your database is getting a little out of hand, with new tables popping up every other day. You don't want to constantly have to be rebuilding your whole app for each new table!</p>
<p>In this case, you would want to call <code>.incremental_generation()</code> on <a href="https://docs.rs/perseus/0.4.0-beta/perseus/struct.Template.html"><code>Template</code></a>, which opens the floodgates, so to speak! Essentially, if we still have our three pages from before (i.e. <code>/entries/foo</code>, <code>/entries/bar</code>, and <code>/entries/baz</code>), and the user goes to <code>/entries/test</code>, rather than sending a <em>404 Not Found</em> error, the Perseus server will run the <em>build state</em> function for this path (<code>entries/test</code>), and it will build for that database table at request-time! Even better, if this all works, it'll cache the results for next time, meaning it can serve <code>/entries/test</code> instantly next time!</p>
<p>As you can imagine, this is <em>extremely</em> useful for templates that render millions, or even billions of pages, since you can build them dynamically and cache them for performance at runtime, rather than spending hours building all of them.</p>
<p>And <em>this</em> is why you the <em>build state</em> function returns a <a href="https://docs.rs/perseus/0.4.0-beta/perseus/type.RenderFnResultWithCause.html"><code>RenderFnResultWithCause</code></a>, because you can <em>blame</em> either the client or the server. Without incremental generation, you know you'll only get those paths you defined in the <em>build paths</em> function, but, with incremental generation, you could get anything. If you know there's one table, say <code>admin</code>, that you should never serve a count for, you can add an if-statement to the top of your <em>build state</em> function that checks if the <code>path</code> argument is <code>entries/admin</code>, and returns a <em>404 Not Found</em> error, blaming the client, and they'll be none the wiser!</p>
<p><em>Note: in applications using both build paths and incremental generation, those paths defined by the build paths function will be rendered at build-time, while any more that aren't defined there will be rendered dynamically upon request.</em></p>
<h2>Examples</h2>
<p>Some of this may be a little tricky to visualize, so there's an example <a href="https://github.com/artic-hen7/perseus/tree/main/examples/core/state_generation">here</a> that goes through each of Perseus' state generation strategies systematically! Note that it doesn't use the same example of a database entry counter as described here, but rather more basic examples to just show the basic functionality of each strategy. Enjoy!</p>
</div></main></div><div data-hk="2.19" class="row-start-2"><footer data-hk="7.0" class="w-full flex justify-center py-5 bg-black text-white"><p data-hk="7.1" class="mx-5 text-center"><span data-hk="7.2">© <a href="https://github.com/arctic-hen7" class="underline">arctic-hen7</a> 2021-2022, see license <a href="https://github.com/arctic-hen7/perseus/blob/main/LICENSE" class="underline">here</a>.</span></p></footer></div></div></div></main><!----><script data-hk="0.0" src=".perseus/static/prism.js" defer=""></script><script data-hk="0.1">window.Prism.highlightAll();</script></div><div id="__perseus_popup_error"></div></body></html>