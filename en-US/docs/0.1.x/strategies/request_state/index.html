<!DOCTYPE html>
<html lang="en" class="light">
    <head>
<base href="https://arctic-hen7.github.io/perseus/" />
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href=".perseus/static/tailwind.css" />
        <link rel="stylesheet" href=".perseus/static/styles/style.css" />
    <script>window.__PERSEUS_RENDER_CFG = '{"docs/strategies/request-state":"docs","docs/define-app":"docs","docs/next/updating":"docs","docs/next/i18n/translations-managers":"docs","docs/updating":"docs","docs/debugging":"docs","docs/0.3.x/plugins/using":"docs","docs/0.2.x/i18n/translations-managers":"docs","docs/0.2.x/intro":"docs","docs/advanced/routing":"docs","docs/0.3.x/strategies/revalidation":"docs","docs/next/snooping":"docs","docs/0.3.x/plugins/writing":"docs","docs/next/debugging":"docs","docs/strategies/amalgamation":"docs","docs/testing/fantoccini-basics":"docs","docs/0.2.x/ejecting":"docs","docs/next/i18n/other-engines":"docs","docs/0.3.x/testing/intro":"docs","docs/0.2.x/templates/metadata-modification":"docs","docs/next/deploying/serverful":"docs","docs/deploying/exporting":"docs","docs/0.2.x/deploying/intro":"docs","comparisons":"comparisons","docs/0.2.x/debugging":"docs","docs/0.1.x/strategies/intro":"docs","docs/0.1.x/tutorials/first_app/setup":"docs","docs/i18n/using":"docs","docs/0.3.x/i18n/using":"docs","docs/0.3.x/intro":"docs","docs/0.2.x/deploying/exporting":"docs","docs/0.3.x/deploying/serverful":"docs","docs/next/strategies/build-paths":"docs","docs/next/second-app":"docs","docs/next/ejecting":"docs","docs/0.3.x/ejecting":"docs","docs/next/advanced/intro":"docs","docs/0.2.x/templates/setting-headers":"docs","docs/0.3.x/static-content":"docs","docs/next/plugins/functional":"docs","docs/next/styling":"docs","docs/next/what-is-perseus":"docs","docs/deploying/intro":"docs","docs/0.3.x/testing/fantoccini-basics":"docs","docs/0.3.x/strategies/build-state":"docs","docs/next/plugins/using":"docs","docs/0.2.x/strategies/intro":"docs","docs/0.2.x/advanced/initial-loads":"docs","docs/0.3.x/define-app":"docs","docs/0.2.x/strategies/amalgamation":"docs","docs/0.2.x/testing/fantoccini-basics":"docs","docs/0.1.x/arch":"docs","docs/0.1.x/setup":"docs","docs/next/intro":"docs","docs/next/deploying/intro":"docs","docs/0.3.x/strategies/incremental":"docs","docs/0.3.x/i18n/other-engines":"docs","docs/next/templates/setting-headers":"docs","docs/strategies/revalidation":"docs","docs/0.3.x/advanced/subsequent-loads":"docs","docs/what-is-perseus":"docs","docs/i18n/other-engines":"docs","docs/cli":"docs","docs/0.3.x/strategies/intro":"docs","docs/next/testing/fantoccini-basics":"docs","docs/next/hello-world":"docs","docs/next/strategies/request-state":"docs","docs/0.2.x/templates/intro":"docs","docs/0.1.x/strategies/build_paths":"docs","docs/next/deploying/relative-paths":"docs","docs/0.1.x/templates":"docs","docs/0.3.x/i18n/intro":"docs","docs/0.1.x/routing":"docs","docs/0.2.x/static-content":"docs","docs/0.3.x/updating":"docs","docs/strategies/build-state":"docs","docs/0.3.x/templates/intro":"docs","docs/0.2.x/i18n/other-engines":"docs","docs/static-content":"docs","docs/next/templates/metadata-modification":"docs","docs/0.1.x/strategies/revalidation":"docs","docs/0.3.x/advanced/intro":"docs","docs/second-app":"docs","docs/next/exporting":"docs","docs/0.2.x/advanced/intro":"docs","docs/next/strategies/incremental":"docs","docs/0.2.x/second-app":"docs","docs/views":"docs","docs/next/strategies/revalidation":"docs","docs/0.3.x/hello-world":"docs","plugins":"plugins","docs/0.3.x/templates/metadata-modification":"docs","docs/next/deploying/size":"docs","docs/0.3.x/plugins/intro":"docs","docs/next/testing/checkpoints":"docs","docs/next/i18n/defining":"docs","docs/0.2.x/what-is-perseus":"docs","docs/next/templates/intro":"docs","docs/0.2.x/strategies/request-state":"docs","docs/advanced/intro":"docs","docs/0.2.x/cli":"docs","docs/0.1.x/strategies/build_state":"docs","docs/next/plugins/intro":"docs","docs/0.3.x/strategies/request-state":"docs","docs/0.1.x/strategies/request_state":"docs","docs/0.2.x/i18n/intro":"docs","docs/next/advanced/subsequent-loads":"docs","docs/0.3.x/advanced/routing":"docs","docs/0.2.x/views":"docs","docs/0.2.x/strategies/build-paths":"docs","docs/0.2.x/updating":"docs","docs/error-pages":"docs","docs/0.3.x/stores":"docs","docs/0.2.x/i18n/using":"docs","docs/advanced/initial-loads":"docs","docs/0.1.x/error_pages":"docs","docs/0.3.x/cli":"docs","docs/0.2.x/define-app":"docs","docs/0.2.x/testing/checkpoints":"docs","docs/0.1.x/integrations/actix-web":"docs","docs/0.3.x/plugins/security":"docs","docs/0.2.x/strategies/revalidation":"docs","docs/0.3.x/testing/checkpoints":"docs","docs/testing/intro":"docs","docs/0.3.x/plugins/control":"docs","docs/styling":"docs","docs/0.3.x/advanced/initial-loads":"docs","docs/0.1.x/config_managers":"docs","docs/0.2.x/error-pages":"docs","docs/templates/metadata-modification":"docs","docs/next/pitfalls-and-bugs":"docs","docs/0.3.x/server-communication":"docs","docs/0.3.x/exporting":"docs","docs/0.3.x/second-app":"docs","docs/advanced/arch":"docs","docs/0.3.x/plugins/tinker":"docs","docs/intro":"docs","docs/0.2.x/strategies/incremental":"docs","docs/next/strategies/build-state":"docs","docs/0.2.x/i18n/defining":"docs","docs/i18n/translations-managers":"docs","docs/next/i18n/intro":"docs","docs/0.1.x/intro":"docs","docs/0.2.x/testing/intro":"docs","docs/next/testing/manual":"docs","docs/0.3.x/advanced/arch":"docs","docs/0.3.x/deploying/serverless":"docs","docs/next/plugins/control":"docs","docs/strategies/intro":"docs","docs/next/strategies/amalgamation":"docs","docs/next/testing/intro":"docs","docs/testing/manual":"docs","docs/advanced/subsequent-loads":"docs","docs/0.3.x/error-pages":"docs","docs/next/deploying/serverless":"docs","docs/0.3.x/deploying/relative-paths":"docs","docs/0.3.x/testing/manual":"docs","docs/config-managers":"docs","docs/templates/setting-headers":"docs","docs/0.2.x/config-managers":"docs","docs/next/static-content":"docs","docs/0.3.x/pitfalls-and-bugs":"docs","docs/0.1.x/tutorials/first_app/app":"docs","docs/strategies/build-paths":"docs","docs/next/advanced/arch":"docs","docs/next/plugins/writing":"docs","docs/next/plugins/tinker":"docs","docs/0.3.x/styling":"docs","docs/0.3.x/plugins/functional":"docs","docs/0.3.x/snooping":"docs","docs/0.2.x/testing/manual":"docs","docs/0.2.x/styling":"docs","docs/templates/intro":"docs","docs/0.3.x/what-is-perseus":"docs","docs/i18n/intro":"docs","docs/0.1.x/serving":"docs","docs/0.3.x/i18n/translations-managers":"docs","docs/0.3.x/views":"docs","docs/0.1.x/tutorials/first_app/intro":"docs","docs/0.3.x/deploying/size":"docs","docs/0.3.x/strategies/build-paths":"docs","docs/next/server-communication":"docs","docs/0.1.x/cli":"docs","docs/0.3.x/templates/setting-headers":"docs","docs/next/error-pages":"docs","docs/0.1.x/tutorials/first_app/template":"docs","docs/next/strategies/intro":"docs","docs/0.2.x/advanced/subsequent-loads":"docs","docs/i18n/defining":"docs","docs/0.3.x/i18n/defining":"docs","docs/0.1.x/strategies/incremental":"docs","docs/ejecting":"docs","docs/0.2.x/strategies/build-state":"docs","docs/hello-world":"docs","docs/next/define-app":"docs","docs":"docs","docs/next/plugins/security":"docs","docs/0.3.x/debugging":"docs","docs/next/advanced/routing":"docs","docs/strategies/incremental":"docs","docs/next/cli":"docs","docs/next/stores":"docs","docs/0.3.x/strategies/amalgamation":"docs","docs/next/i18n/using":"docs","docs/testing/checkpoints":"docs","docs/0.3.x/deploying/intro":"docs","docs/next/advanced/initial-loads":"docs","docs/0.1.x/building":"docs","docs/0.2.x/advanced/routing":"docs","docs/0.2.x/hello-world":"docs","docs/next/views":"docs","index":"index","docs/0.2.x/advanced/arch":"docs"}';</script>
<script type="module">
    import init, { run } from "https://arctic-hen7.github.io/perseus/.perseus/bundle.js";
    async function main() {
        await init("https://arctic-hen7.github.io/perseus/.perseus/bundle.wasm");
        run();
    }
    main();
</script>
<!--PERSEUS_INTERPOLATED_HEAD_BEGINS--><title>Request State | Perseus Docs</title><link rel="stylesheet" href=".perseus/static/styles/markdown.css"/><link href=".perseus/static/styles/docs_links_markdown.css" rel="stylesheet"/><link rel="stylesheet" href=".perseus/static/prism.css"/>
<script>window.__PERSEUS_INITIAL_STATE = `{"title":"Request State","content":"<h1>Request State</h1>\\n<p>This strategy allows you to define the state for a page at request-time, which gives you access to information like the headers of the user's HTTP request (including any authorization tokens) and real-time factors. This can be useful if you want to render something like a user dashboard on the server, which you wouldn't be able to do with the <em>build state</em> strategy, as it only has access to information at build-time.</p>\\n<p>It should be noted that this strategy is much slower than build-time strategies, as it requires extra computations on the server every time a user requests a page. However, this strategy is superior to client-side rendering (rendering a page at build time with fillers for unique content that you then fill in in the browser) in some ways. This strategy is essentially server-side rendering, and you can read more about its performance <a href=\\"https://medium.com/walmartglobaltech/the-benefits-of-server-side-rendering-over-client-side-rendering-5d07ff2cefe8\\">here</a>.</p>\\n<h2>Using with Build State</h2>\\n<p>Perseus supports using both build and request state simultaneously, though it's not advised unless absolutely necessary. This will result in the generation of two competing states, one from build and one from request, which you can then amalgamate by using the <code>amalgamate_states</code> strategy. Due to the phenomenally niche nature of this approach, it's not covered in depth in the documentation, but you can check out the <code>showcase</code> example if you want to see it in action (specifically the <code>amalgamate</code> page).</p>\\n<h2>Usage</h2>\\n<p>You can define a function for this strategy like so (this will tell the user their own IP address):</p>\\n<pre><code class=\\"language-rust\\">use serde::{Deserialize, Serialize};\\nuse perseus::ErrorCause;\\n\\n#[derive(Serialize, Deserialize)]\\npub struct IpPageProps {\\n    ip: String,\\n}\\npub async fn get_request_state(_path: String, req: Request) -&gt; Result&lt;String, (String, ErrorCause)&gt; {\\n    Ok(serde_json::to_string(&amp;IpPageProps {\\n        // Gets the client's IP address\\n        ip: format!(\\n            &quot;{:?}&quot;,\\n            req\\n                .headers()\\n                .get(&quot;X-Forwarded-For&quot;)\\n                .unwrap_or(&amp;perseus::http::HeaderValue::from_str(&quot;hidden from view!&quot;).unwrap())\\n        ),\\n    })\\n    .unwrap())\\n}\\n</code></pre>\\n<p>This function can produce two kinds of errors, broadly: those caused by the server, and those caused by the client. For that reason, you need to return a <code>(String, ErrorCause)</code> tuple, the second part of which specifies who's responsible for the error. This allows Perseus to figure out whether it should send a 400 (client error) or 500 (server error) HTTP status code in the event of an error. This function must also be asynchronous.</p>\\n<p>As with the <em>build state</em> strategy, you must return state from this function as a string, and the path provided to this function is the same as the final path at which the page will be rendered.</p>\\n<p>You can add this strategy to a template like so:</p>\\n<pre><code class=\\"language-rust\\">template\\n\\t// ...\\n    .request_state_fn(Box::new(get_request_state))\\n</code></pre>\\n","sidebar_content":"<ul>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/intro\\">Introduction</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/setup\\">Setup</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/arch\\">Architecture</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/intro\\">Building Your First App</a>\\n<ul>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/setup\\">Installation and Setup</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/template\\">Writing Your First Template</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/app\\">Setting up the App Itself</a></li>\\n</ul>\\n</li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/cli\\">CLI</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/templates\\">Templates</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/routing\\">Routing</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/error_pages\\">Error Pages</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/intro\\">Rendering Strategies</a>\\n<ul>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/build_paths\\">Build Paths</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/build_state\\">Build State</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/request_state\\">Request State</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/revalidation\\">Revalidation</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/incremental\\">Incremental generation</a></li>\\n</ul>\\n</li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/building\\">Building</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/serving\\">Serving</a>\\n<ul>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/integrations/actix-web\\">Actix Web Integration</a></li>\\n</ul>\\n</li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/config_managers\\">Config Managers</a></li>\\n</ul>\\n","status":"Outdated","manifest":{"stable":"0.2.x","outdated":["0.1.x"],"beta":["0.3.x"],"history_map":{"0.1.x":"v0.1.4","0.2.x":"v0.2.3","0.3.x":"HEAD"}},"current_version":"0.1.x"}`;</script>
</head>
    <body class="bg-white dark:bg-navy">
        <div id="root"><div id="__perseus_content_initial" class="__perseus_content"><header class="shadow-md sm:p-2 w-full bg-white dark:text-white dark:bg-navy mb-20"><div class="flex justify-between"><a class="justify-self-start self-center m-3 ml-5 text-md sm:text-2xl" href="en-US/">Perseus</a><div class="md:hidden m-3 mr-5 tham tham-e-spin tham-w-6 "><div class="tham-box"><div class="dark:bg-white tham-inner"></div></div></div><nav class="hidden md:flex"><ul class="mr-5 flex"><li class="m-3 p-1"><a class="px-2" href="en-US/docs">Docs</a></li><li class="m-3 p-1"><a class="px-2" href="en-US/comparisons">Comparisons</a></li><li class="m-3 p-1"><a href="en-US/plugins" class="px-2">Plugins</a></li></ul></nav></div><nav id="mobile_nav_menu" class="md:hidden w-full text-center justify-center overflow-y-scroll hidden"><div class="mr-5 overflow-y-scroll" style="max-height: 500px"><ul><li class="m-3 p-1"><a class="px-2" href="en-US/docs">Docs</a></li><li class="m-3 p-1"><a class="px-2" href="en-US/comparisons">Comparisons</a></li><li class="m-3 p-1"><a href="en-US/plugins" class="px-2">Plugins</a></li></ul><hr/><div class="text-left p-3"><!----><select class="p-2 rounded-md text-white bg-indigo-500"><option value="next">Next (unreleased)</option><option value="0.3.x">v⁨0.3.x⁩ (beta)</option><option value="0.2.x">v⁨0.2.x⁩ (stable)</option><option value="0.1.x" selected="">v⁨0.1.x⁩ (outdated)</option></select><div class="docs-links-markdown"><ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/intro">Introduction</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/setup">Setup</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/arch">Architecture</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/intro">Building Your First App</a>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/setup">Installation and Setup</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/template">Writing Your First Template</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/app">Setting up the App Itself</a></li>
</ul>
</li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/cli">CLI</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/templates">Templates</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/routing">Routing</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/error_pages">Error Pages</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/intro">Rendering Strategies</a>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/build_paths">Build Paths</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/build_state">Build State</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/request_state">Request State</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/revalidation">Revalidation</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/incremental">Incremental generation</a></li>
</ul>
</li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/building">Building</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/serving">Serving</a>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/integrations/actix-web">Actix Web Integration</a></li>
</ul>
</li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/config_managers">Config Managers</a></li>
</ul>
</div></div></div></nav></header><div class="mt-14 xs:mt-16 sm:mt-20 lg:mt-25 overflow-y-auto flex"><div class="flex w-full"><div class="h-full hidden md:block max-w-xs w-full border-r"><div class="mr-5"><div class="text-left text-black dark:text-white p-3"><aside><!----><select class="p-2 rounded-md text-white bg-indigo-500"><option value="next">Next (unreleased)</option><option value="0.3.x">v⁨0.3.x⁩ (beta)</option><option value="0.2.x">v⁨0.2.x⁩ (stable)</option><option value="0.1.x" selected="">v⁨0.1.x⁩ (outdated)</option></select><div class="docs-links-markdown"><ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/intro">Introduction</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/setup">Setup</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/arch">Architecture</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/intro">Building Your First App</a>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/setup">Installation and Setup</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/template">Writing Your First Template</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/app">Setting up the App Itself</a></li>
</ul>
</li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/cli">CLI</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/templates">Templates</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/routing">Routing</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/error_pages">Error Pages</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/intro">Rendering Strategies</a>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/build_paths">Build Paths</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/build_state">Build State</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/request_state">Request State</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/revalidation">Revalidation</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/incremental">Incremental generation</a></li>
</ul>
</li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/building">Building</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/serving">Serving</a>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/integrations/actix-web">Actix Web Integration</a></li>
</ul>
</li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/config_managers">Config Managers</a></li>
</ul>
</div></aside></div></div></div><div class="h-full flex w-full"><div class="px-3 w-full sm:mr-auto sm:ml-auto sm:max-w-prose lg:max-w-3xl xl:max-w-4xl 2xl:max-w-5xl"><div class="ring-4 ring-red-400 p-4 rounded-lg mt-1"><div class="flex flex-col 2xs:flex-row dark:text-white"><span class="self-center mr-2" style="fill: #f87171;"><svg xmlns="http://www.w3.org/2000/svg" height="auto" viewBox="0 0 24 24" width="2.25rem" fill="\#000000"><path d="M12 7c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1s-1-.45-1-1V8c0-.55.45-1 1-1zm-.01-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm1-3h-2v-2h2v2z"/></svg></span><p>This version of the documentation is outdated, and features documented here may work differently now. You can see the latest stable version of the docs <a href="en-US/docs/0.2.x/intro" class="underline">here</a>.</p></div></div><main class="text-black dark:text-white"><div class="markdown"><h1>Request State</h1>
<p>This strategy allows you to define the state for a page at request-time, which gives you access to information like the headers of the user's HTTP request (including any authorization tokens) and real-time factors. This can be useful if you want to render something like a user dashboard on the server, which you wouldn't be able to do with the <em>build state</em> strategy, as it only has access to information at build-time.</p>
<p>It should be noted that this strategy is much slower than build-time strategies, as it requires extra computations on the server every time a user requests a page. However, this strategy is superior to client-side rendering (rendering a page at build time with fillers for unique content that you then fill in in the browser) in some ways. This strategy is essentially server-side rendering, and you can read more about its performance <a href="https://medium.com/walmartglobaltech/the-benefits-of-server-side-rendering-over-client-side-rendering-5d07ff2cefe8">here</a>.</p>
<h2>Using with Build State</h2>
<p>Perseus supports using both build and request state simultaneously, though it's not advised unless absolutely necessary. This will result in the generation of two competing states, one from build and one from request, which you can then amalgamate by using the <code>amalgamate_states</code> strategy. Due to the phenomenally niche nature of this approach, it's not covered in depth in the documentation, but you can check out the <code>showcase</code> example if you want to see it in action (specifically the <code>amalgamate</code> page).</p>
<h2>Usage</h2>
<p>You can define a function for this strategy like so (this will tell the user their own IP address):</p>
<pre><code class="language-rust">use serde::{Deserialize, Serialize};
use perseus::ErrorCause;

#[derive(Serialize, Deserialize)]
pub struct IpPageProps {
    ip: String,
}
pub async fn get_request_state(_path: String, req: Request) -&gt; Result&lt;String, (String, ErrorCause)&gt; {
    Ok(serde_json::to_string(&amp;IpPageProps {
        // Gets the client's IP address
        ip: format!(
            &quot;{:?}&quot;,
            req
                .headers()
                .get(&quot;X-Forwarded-For&quot;)
                .unwrap_or(&amp;perseus::http::HeaderValue::from_str(&quot;hidden from view!&quot;).unwrap())
        ),
    })
    .unwrap())
}
</code></pre>
<p>This function can produce two kinds of errors, broadly: those caused by the server, and those caused by the client. For that reason, you need to return a <code>(String, ErrorCause)</code> tuple, the second part of which specifies who's responsible for the error. This allows Perseus to figure out whether it should send a 400 (client error) or 500 (server error) HTTP status code in the event of an error. This function must also be asynchronous.</p>
<p>As with the <em>build state</em> strategy, you must return state from this function as a string, and the path provided to this function is the same as the final path at which the page will be rendered.</p>
<p>You can add this strategy to a template like so:</p>
<pre><code class="language-rust">template
	// ...
    .request_state_fn(Box::new(get_request_state))
</code></pre>
</div></main></div></div></div></div><footer class="w-full flex justify-center py-5 bg-gray-100 dark:bg-navy-deep"><p class="dark:text-white mx-5 text-center"><span>© <a href="https://github.com/arctic-hen7" class="underline">arctic-hen7</a> ⁨2021⁩, see license <a href="https://github.com/arctic-hen7/perseus/blob/main/LICENSE" class="underline">here</a>.</span></p></footer><script defer="" src=".perseus/static/prism.js"></script><script>window.Prism.highlightAll();</script></div></div>
    </body>
</html>
