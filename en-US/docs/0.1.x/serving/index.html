<!DOCTYPE html>
<html lang="en" class="light">
    <head>
<base href="https://arctic-hen7.github.io/perseus/" />
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href=".perseus/static/tailwind.css" />
        <link rel="stylesheet" href=".perseus/static/styles/style.css" />
    <script>window.__PERSEUS_RENDER_CFG = '{"plugins":"plugins","docs/views":"docs","docs/0.3.0-0.3.3/i18n/defining":"docs","docs/next/reference/plugins/functional":"docs","docs/0.3.0-0.3.3/deploying/relative-paths":"docs","docs/0.3.0-0.3.3/templates/setting-headers":"docs","docs/next/what-is-perseus":"docs","docs/templates/intro":"docs","docs/0.2.x/i18n/intro":"docs","docs/0.2.x/advanced/arch":"docs","docs/server-communication":"docs","docs/second-app":"docs","docs/0.3.0-0.3.3/advanced/define_app":"docs","docs/next/reference/i18n/other-engines":"docs","docs/next/reference/pitfalls-and-bugs":"docs","docs/plugins/intro":"docs","docs/snooping":"docs","docs/0.3.0-0.3.3/advanced/subsequent-loads":"docs","docs/0.1.x/strategies/revalidation":"docs","docs/next/core-principles":"docs","docs/0.3.0-0.3.3/pitfalls-and-bugs":"docs","docs/deploying/serverful":"docs","docs/next/reference/i18n/translations-managers":"docs","docs/0.2.x/templates/metadata-modification":"docs","docs/0.3.0-0.3.3/error-pages":"docs","docs/next/reference/strategies/build-paths":"docs","docs/0.2.x/intro":"docs","docs/0.2.x/i18n/other-engines":"docs","docs/next/reference/server-communication":"docs","docs/next/reference/templates/metadata-modification":"docs","docs/0.1.x/strategies/incremental":"docs","docs/0.2.x/testing/fantoccini-basics":"docs","docs/advanced/routing":"docs","docs/0.2.x/strategies/request-state":"docs","docs/next/advanced/intro":"docs","docs/next/reference/ejecting":"docs","docs/next/reference/state/global":"docs","docs/next/reference/strategies/amalgamation":"docs","docs/strategies/build-state":"docs","docs/0.2.x/define-app":"docs","index":"index","docs/updating":"docs","docs/0.3.0-0.3.3/plugins/control":"docs","docs/0.2.x/strategies/incremental":"docs","docs/0.2.x/advanced/intro":"docs","docs/strategies/intro":"docs","docs/hydration":"docs","docs/next/reference/i18n/intro":"docs","docs/next/tutorials/hello-world":"docs","docs/0.3.0-0.3.3/advanced/routing":"docs","docs/plugins/functional":"docs","docs/next/reference/testing/fantoccini-basics":"docs","docs/plugins/using":"docs","docs/next/reference/i18n/defining":"docs","docs/0.3.0-0.3.3/server-communication":"docs","docs/0.3.0-0.3.3/intro":"docs","docs/0.1.x/strategies/build_state":"docs","docs/0.3.0-0.3.3/views":"docs","docs/0.3.0-0.3.3/deploying/serverful":"docs","docs/0.3.0-0.3.3/testing/fantoccini-basics":"docs","docs/0.2.x/i18n/using":"docs","docs/testing/checkpoints":"docs","docs/plugins/security":"docs","docs/0.3.0-0.3.3/strategies/request-state":"docs","docs/next/reference/views":"docs","docs/next/reference/deploying/serverful":"docs","docs/plugins/publishing":"docs","docs/0.2.x/i18n/translations-managers":"docs","docs/0.3.0-0.3.3/i18n/translations-managers":"docs","docs/deploying/serverless":"docs","docs/i18n/defining":"docs","docs/0.2.x/advanced/routing":"docs","docs/deploying/intro":"docs","docs/0.2.x/cli":"docs","docs/next/reference/error-pages":"docs","docs/0.3.0-0.3.3/ejecting":"docs","docs/0.2.x/i18n/defining":"docs","docs/next/advanced/subsequent-loads":"docs","docs/next/tutorials/second-app":"docs","docs/0.3.0-0.3.3/hydration":"docs","docs/next/reference/plugins/tinker":"docs","docs/0.2.x/templates/intro":"docs","docs/what-is-perseus":"docs","docs/0.2.x/strategies/revalidation":"docs","docs/0.1.x/integrations/actix-web":"docs","docs/0.2.x/static-content":"docs","docs/0.3.0-0.3.3/deploying/docker":"docs","docs":"docs","docs/0.2.x/what-is-perseus":"docs","docs/0.1.x/strategies/request_state":"docs","docs/plugins/writing":"docs","docs/0.3.0-0.3.3/strategies/build-state":"docs","docs/next/advanced/routing":"docs","docs/0.1.x/strategies/intro":"docs","docs/advanced/subsequent-loads":"docs","docs/hello-world":"docs","docs/0.3.0-0.3.3/i18n/intro":"docs","docs/0.3.0-0.3.3/strategies/incremental":"docs","docs/next/reference/static-content":"docs","docs/0.3.0-0.3.3/templates/metadata-modification":"docs","comparisons":"comparisons","docs/stores":"docs","docs/testing/fantoccini-basics":"docs","docs/0.3.0-0.3.3/deploying/serverless":"docs","docs/0.1.x/cli":"docs","docs/0.2.x/ejecting":"docs","docs/plugins/tinker":"docs","docs/i18n/translations-managers":"docs","docs/0.2.x/debugging":"docs","docs/0.3.0-0.3.3/what-is-perseus":"docs","docs/advanced/intro":"docs","docs/0.2.x/templates/setting-headers":"docs","docs/next/intro":"docs","docs/0.2.x/testing/checkpoints":"docs","docs/0.3.0-0.3.3/advanced/arch":"docs","docs/0.3.0-0.3.3/templates/intro":"docs","docs/next/reference/templates/setting-headers":"docs","docs/0.1.x/serving":"docs","docs/next/reference/plugins/control":"docs","docs/0.3.0-0.3.3/advanced/initial-loads":"docs","docs/0.3.0-0.3.3/cli":"docs","docs/next/reference/testing/checkpoints":"docs","docs/0.2.x/error-pages":"docs","docs/strategies/build-paths":"docs","docs/next/reference/exporting":"docs","docs/0.1.x/setup":"docs","docs/deploying/docker":"docs","docs/next/reference/live-reloading":"docs","docs/next/reference/index-view":"docs","docs/next/reference/deploying/size":"docs","docs/0.3.0-0.3.3/define-app":"docs","docs/0.3.0-0.3.3/plugins/publishing":"docs","docs/0.3.0-0.3.3/hello-world":"docs","docs/next/reference/state/idb-freezing":"docs","docs/next/reference/deploying/relative-paths":"docs","docs/deploying/relative-paths":"docs","docs/0.3.0-0.3.3/i18n/using":"docs","docs/0.3.0-0.3.3/styling":"docs","docs/0.2.x/updating":"docs","docs/0.3.0-0.3.3/strategies/intro":"docs","docs/0.3.0-0.3.3/plugins/writing":"docs","docs/0.2.x/strategies/build-state":"docs","docs/0.3.0-0.3.3/testing/intro":"docs","docs/templates/setting-headers":"docs","docs/0.3.0-0.3.3/strategies/amalgamation":"docs","docs/0.2.x/hello-world":"docs","docs/strategies/amalgamation":"docs","docs/0.1.x/arch":"docs","docs/0.3.0-0.3.3/static-content":"docs","docs/next/reference/strategies/revalidation":"docs","docs/advanced/initial-loads":"docs","docs/0.1.x/config_managers":"docs","docs/0.2.x/advanced/subsequent-loads":"docs","docs/0.3.0-0.3.3/strategies/revalidation":"docs","docs/next/reference/deploying/intro":"docs","docs/0.3.0-0.3.3/plugins/tinker":"docs","docs/advanced/arch":"docs","docs/testing/intro":"docs","docs/next/reference/strategies/intro":"docs","docs/plugins/control":"docs","docs/0.2.x/deploying/exporting":"docs","docs/0.3.0-0.3.3/plugins/intro":"docs","docs/0.2.x/advanced/initial-loads":"docs","docs/define-app":"docs","docs/0.3.0-0.3.3/plugins/security":"docs","docs/next/reference/cli":"docs","docs/0.2.x/config-managers":"docs","docs/0.2.x/strategies/build-paths":"docs","docs/0.3.0-0.3.3/deploying/intro":"docs","docs/next/reference/state/freezing":"docs","docs/next/reference/state/rx":"docs","docs/0.3.0-0.3.3/snooping":"docs","docs/next/reference/deploying/serverless":"docs","docs/0.2.x/deploying/intro":"docs","docs/0.2.x/testing/intro":"docs","docs/intro":"docs","docs/next/reference/plugins/publishing":"docs","docs/0.1.x/intro":"docs","docs/next/reference/styling":"docs","docs/0.3.0-0.3.3/exporting":"docs","docs/next/reference/engines":"docs","docs/next/reference/strategies/incremental":"docs","docs/0.3.0-0.3.3/strategies/build-paths":"docs","docs/next/reference/testing/intro":"docs","docs/i18n/other-engines":"docs","docs/next/advanced/arch":"docs","docs/0.2.x/styling":"docs","docs/next/reference/state/hsr":"docs","docs/next/reference/templates/router-state":"docs","docs/next/advanced/initial-loads":"docs","docs/debugging":"docs","docs/exporting":"docs","docs/static-content":"docs","docs/advanced/define_app":"docs","docs/next/reference/plugins/using":"docs","docs/next/reference/debugging":"docs","docs/0.1.x/tutorials/first_app/intro":"docs","docs/next/reference/stores":"docs","docs/0.1.x/routing":"docs","docs/0.3.0-0.3.3/i18n/other-engines":"docs","docs/strategies/request-state":"docs","docs/i18n/intro":"docs","docs/0.3.0-0.3.3/testing/manual":"docs","docs/0.2.x/strategies/intro":"docs","docs/0.3.0-0.3.3/plugins/using":"docs","docs/next/reference/templates/intro":"docs","docs/next/reference/testing/manual":"docs","docs/next/reference/strategies/build-state":"docs","docs/0.1.x/building":"docs","docs/0.2.x/views":"docs","docs/deploying/size":"docs","docs/cli":"docs","docs/next/reference/snooping":"docs","docs/0.3.0-0.3.3/advanced/intro":"docs","docs/0.2.x/second-app":"docs","docs/next/reference/strategies/request-state":"docs","docs/0.3.0-0.3.3/updating":"docs","docs/0.3.0-0.3.3/deploying/size":"docs","docs/0.1.x/error_pages":"docs","docs/strategies/incremental":"docs","docs/0.3.0-0.3.3/stores":"docs","docs/i18n/using":"docs","docs/next/reference/hydration":"docs","docs/error-pages":"docs","docs/next/reference/plugins/writing":"docs","docs/0.3.0-0.3.3/testing/checkpoints":"docs","docs/next/reference/plugins/security":"docs","docs/0.1.x/strategies/build_paths":"docs","docs/next/reference/perseus-app":"docs","docs/0.3.0-0.3.3/second-app":"docs","docs/pitfalls-and-bugs":"docs","docs/next/reference/updating":"docs","docs/next/reference/deploying/docker":"docs","docs/0.1.x/tutorials/first_app/template":"docs","docs/next/advanced/define_app":"docs","docs/next/reference/i18n/using":"docs","docs/testing/manual":"docs","docs/0.1.x/tutorials/first_app/app":"docs","docs/templates/metadata-modification":"docs","docs/styling":"docs","docs/next/advanced/route-announcer":"docs","docs/0.2.x/testing/manual":"docs","docs/0.3.0-0.3.3/debugging":"docs","docs/strategies/revalidation":"docs","docs/0.1.x/templates":"docs","docs/next/reference/plugins/intro":"docs","docs/next/reference/define-app":"docs","docs/0.1.x/tutorials/first_app/setup":"docs","docs/ejecting":"docs","docs/0.2.x/strategies/amalgamation":"docs","docs/0.3.0-0.3.3/plugins/functional":"docs"}';</script>
<script type="module">
    import init, { run } from "https://arctic-hen7.github.io/perseus/.perseus/bundle.js";
    async function main() {
        await init("https://arctic-hen7.github.io/perseus/.perseus/bundle.wasm");
        run();
    }
    main();
</script>
<!--PERSEUS_INTERPOLATED_HEAD_BEGINS--><title data-hk="1.0">Serving | Perseus Docs</title><link rel="stylesheet" href=".perseus/static/styles/markdown.css" data-hk="1.1"/><link href=".perseus/static/styles/docs_links_markdown.css" data-hk="1.2" rel="stylesheet"/><link data-hk="1.3" href=".perseus/static/prism.css" rel="stylesheet"/>
<script>window.__PERSEUS_INITIAL_STATE = `{"title":"Serving","content":"<h1>Serving</h1>\\n<p><em>You only need this page if you're not using the Perseus CLI, which performs this process for you!</em></p>\\n<p>Having generated a large number of static files, you'll need a system to host your files for you! Due to the dynamic nature of some rendering strategies, Perseus needs to be involved in this process (for executing request-time logic), and so it provides a simple API interface for serving pages.</p>\\n<p>Perseus aims to be agnostic as to what framework you use to host your files, and any framework that gives you access to request headers and wildcard paths should work (in other words, any framework worth its salt).</p>\\n<p>If you're using one of our supported integrations, you don't have to bother with this page, nearly all of it can be done for you!</p>\\n<ul>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/integrations/actix-web\\">Actix Web</a></li>\\n<li><em>More coming soon...</em></li>\\n</ul>\\n<h2>Endpoints</h2>\\n<p>Here are the endpoints that a server for Perseus must serve:</p>\\n<ul>\\n<li><code>/.perseus/page/*</code> – used to serve the JSON data that the app shell needs to render a page (<code>*</code> should be extractable as a filename, e.g. <code>{filename:.*}</code> in Actix Web)</li>\\n<li><code>/.perseus/bundle.js</code> – the JavaScript bundle file that calls your Wasm code (see <a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/intro\\">tutorial on building your first app</a>)</li>\\n<li><code>/.perseus/bundle.wasm</code> – the Wasm bundle file that contains your code (see <a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/intro\\">tutorial on building your first app</a>)</li>\\n<li><code>*</code> (anything else) – any page that the user actually requests, which will return the app shell to do the heavy lifting (or more accurately an HTML file that includes the bundle)</li>\\n</ul>\\n<h2>Usage</h2>\\n<p>This example shows what would be done to acquire a page for any framework. You'll need to have access to these data to get a page:</p>\\n<ul>\\n<li>The page path the user requested, e.g. <code>/post/test</code> for a request to <code>/.perseus/page/post/test</code></li>\\n<li>Data about the HTTP request the user sent (see below)</li>\\n<li>A map of templates produced with <a href=\\"\\"><code>get_templates_map!</code></a> (API docs WIP)</li>\\n<li>A <a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/config_managers\\">config manager</a></li>\\n</ul>\\n<pre><code class=\\"language-rust\\">use perseus::{get_page};\\n\\n// See below for details on this line\\nlet http_req = convert_req(&amp;req).unwrap();\\n\\nlet page_data = get_page(path, http_req, &amp;render_cfg, &amp;templates, config_manager.get_ref()).await;\\n\\nmatch page_data {\\n    Ok(page_data) =&gt; // Return a 200 with the stringified \`page_data\`\\n    // We parse the error to return an appropriate status code\\n    Err(err) =&gt; // Return the error dictated by \`err_to_status_code(&amp;err)\` with the body of the stringified \`err\`\\n}\\n</code></pre>\\n<h2>Request Data</h2>\\n<p>Perseus needs access to information about HTTP requests so it can perform tasks related to the <em>request state</em> strategy, which provides access to headers and the like. Internally, Perseus uses <a href=\\"https://docs.rs/http/0.2.4/http/request/struct.Request.html\\"><code>http::Request</code></a> for this, with the body type <code>()</code> (payloads are irrelevant in requests that ask for a page at a URL).</p>\\n<p>Unfortunately, different web server frameworks represent request data differently, and so you'll need to convert from your framework's system to <code>http</code>'s. When integrations are ready, this will be done for you!</p>\\n<h3>Writing a Converter</h3>\\n<p>This is a simplified version of an Actix Web converter:</p>\\n<pre><code class=\\"language-rust\\">use perseus::{HttpRequest, Request};\\n\\n/// Converts an Actix Web request into an \`http::request\`.\\npub fn convert_req(raw: &amp;actix_web::HttpRequest) -&gt; Result&lt;Request, String&gt; {\\n\\tlet mut builder = HttpRequest::builder();\\n\\t// Add headers one by one\\n\\tfor (name, val) in raw.headers() {\\n\\t\\t// Each method call consumes and returns \`self\`, so we re-self-assign\\n\\t\\tbuilder = builder.header(name, val);\\n\\t}\\n\\t// The URI to which the request was sent\\n\\tbuilder = builder.uri(raw.uri());\\n\\t// The method (e.g. GET, POST, etc.)\\n\\tbuilder = builder.method(raw.method());\\n\\t// The HTTP version used\\n\\tbuilder = builder.version(raw.version());\\n\\n\\tlet req = builder\\n\\t\\t// We always use an empty body because, in a Perseus request, only the URI matters\\n\\t\\t// Any custom data should therefore be sent in headers (if you're doing that, consider a dedicated API)\\n\\t\\t.body(())\\n\\t\\t.map_err(|err| format!(&quot;converting actix web request to perseus-compliant request failed: '{}'&quot;, err))?;\\n\\n\\tOk(req)\\n}\\n</code></pre>\\n<p>Notably, the data that need to be converted are:</p>\\n<ul>\\n<li>Headers</li>\\n<li>URI to which the request was sent</li>\\n<li>HTTP method (subject to change in future Perseus versions, currently <code>GET</code>)</li>\\n<li>HTTP version used</li>\\n</ul>\\n<p>Note that mis-converting any of these data will not affect Perseus (which doesn't require any of them to function), only your own code. So if you have no intention of using the <em>request state</em> strategy in your app, you could theoretically just parse an empty request to Perseus like so:</p>\\n<pre><code class=\\"language-rust\\">use perseus::HttpRequest\\n\\nHttpRequest::new(());\\n</code></pre>\\n<h2>File Storage</h2>\\n<p>Perseus' systems of storing files in production are documented in-depth <a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/config_managers\\">here</a>.</p>\\n","sidebar_content":"<ul>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/intro\\">Introduction</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/setup\\">Setup</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/arch\\">Architecture</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/intro\\">Building Your First App</a>\\n<ul>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/setup\\">Installation and Setup</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/template\\">Writing Your First Template</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/app\\">Setting up the App Itself</a></li>\\n</ul>\\n</li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/cli\\">CLI</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/templates\\">Templates</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/routing\\">Routing</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/error_pages\\">Error Pages</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/intro\\">Rendering Strategies</a>\\n<ul>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/build_paths\\">Build Paths</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/build_state\\">Build State</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/request_state\\">Request State</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/revalidation\\">Revalidation</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/incremental\\">Incremental generation</a></li>\\n</ul>\\n</li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/building\\">Building</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/serving\\">Serving</a>\\n<ul>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/integrations/actix-web\\">Actix Web Integration</a></li>\\n</ul>\\n</li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/config_managers\\">Config Managers</a></li>\\n</ul>\\n","status":"Outdated","manifest":{"stable":"0.3.0-0.3.3","outdated":["0.2.x","0.1.x"],"beta":[],"history_map":{"0.3.0-0.3.3":"v0.3.3","0.1.x":"v0.1.4","0.2.x":"v0.2.3"}},"current_version":"0.1.x"}`;</script>
</head>
    <body class="bg-white dark:bg-navy">
        <div id="root"><div id="__perseus_content_initial" class="__perseus_content"><header class="shadow-md sm:p-2 w-full bg-white dark:text-white dark:bg-navy mb-20" data-hk="3.0"><div class="flex justify-between" data-hk="3.1"><a data-hk="3.2" class="justify-self-start self-center m-3 ml-5 text-md sm:text-2xl" href="en-US/">Perseus</a><div class="md:hidden m-3 mr-5 tham tham-e-spin tham-w-6 " data-hk="3.3"><div data-hk="3.4" class="tham-box"><div class="dark:bg-white tham-inner" data-hk="3.5"></div></div></div><nav data-hk="3.6" class="hidden md:flex"><ul class="mr-5 flex" data-hk="3.7"><li class="m-3 p-1" data-hk="4.0"><a href="en-US/docs" class="px-2" data-hk="4.1">Docs</a></li><li data-hk="4.2" class="m-3 p-1"><a class="px-2" data-hk="4.3" href="en-US/comparisons">Comparisons</a></li><li data-hk="4.4" class="m-3 p-1"><a class="px-2" href="en-US/plugins" data-hk="4.5">Plugins</a></li></ul></nav></div><nav data-hk="3.8" id="mobile_nav_menu" class="md:hidden w-full text-center justify-center overflow-y-scroll hidden"><div class="mr-5 overflow-y-scroll" style="max-height: 500px" data-hk="3.9"><ul data-hk="3.10"><li class="m-3 p-1" data-hk="5.0"><a data-hk="5.1" href="en-US/docs" class="px-2">Docs</a></li><li data-hk="5.2" class="m-3 p-1"><a data-hk="5.3" href="en-US/comparisons" class="px-2">Comparisons</a></li><li class="m-3 p-1" data-hk="5.4"><a href="en-US/plugins" class="px-2" data-hk="5.5">Plugins</a></li></ul><hr data-hk="3.11"/><div data-hk="3.12" class="text-left p-3"><!--#--><!----><select data-hk="6.0" class="p-2 rounded-md text-white bg-indigo-500"><option data-hk="6.1" value="next">Next (unreleased)</option><!--#--><!--/--><option data-hk="6.2" value="0.3.0-0.3.3">v⁨0.3.0-0.3.3⁩ (stable)</option><!--#--><option value="0.2.x" data-hk="6.3">v⁨0.2.x⁩ (outdated)</option><option value="0.1.x" data-hk="6.4" selected="">v⁨0.1.x⁩ (outdated)</option><!--/--></select><!--/--><div class="docs-links-markdown" data-hk="3.13"><ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/intro">Introduction</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/setup">Setup</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/arch">Architecture</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/intro">Building Your First App</a>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/setup">Installation and Setup</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/template">Writing Your First Template</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/app">Setting up the App Itself</a></li>
</ul>
</li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/cli">CLI</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/templates">Templates</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/routing">Routing</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/error_pages">Error Pages</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/intro">Rendering Strategies</a>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/build_paths">Build Paths</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/build_state">Build State</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/request_state">Request State</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/revalidation">Revalidation</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/incremental">Incremental generation</a></li>
</ul>
</li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/building">Building</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/serving">Serving</a>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/integrations/actix-web">Actix Web Integration</a></li>
</ul>
</li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/config_managers">Config Managers</a></li>
</ul>
</div></div></div></nav></header><div class="mt-14 xs:mt-16 sm:mt-20 lg:mt-25 overflow-y-auto flex" data-hk="3.14"><div class="flex w-full" data-hk="3.15"><div data-hk="3.16" class="h-full hidden md:block max-w-xs w-full border-r"><div class="mr-5" data-hk="3.17"><div class="text-left text-black dark:text-white p-3" data-hk="3.18"><aside data-hk="3.19"><!--#--><!----><select data-hk="7.0" class="p-2 rounded-md text-white bg-indigo-500"><option data-hk="7.1" value="next">Next (unreleased)</option><!--#--><!--/--><option data-hk="7.2" value="0.3.0-0.3.3">v⁨0.3.0-0.3.3⁩ (stable)</option><!--#--><option data-hk="7.3" value="0.2.x">v⁨0.2.x⁩ (outdated)</option><option value="0.1.x" data-hk="7.4" selected="">v⁨0.1.x⁩ (outdated)</option><!--/--></select><!--/--><div class="docs-links-markdown" data-hk="3.20"><ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/intro">Introduction</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/setup">Setup</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/arch">Architecture</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/intro">Building Your First App</a>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/setup">Installation and Setup</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/template">Writing Your First Template</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/app">Setting up the App Itself</a></li>
</ul>
</li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/cli">CLI</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/templates">Templates</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/routing">Routing</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/error_pages">Error Pages</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/intro">Rendering Strategies</a>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/build_paths">Build Paths</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/build_state">Build State</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/request_state">Request State</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/revalidation">Revalidation</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/strategies/incremental">Incremental generation</a></li>
</ul>
</li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/building">Building</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/serving">Serving</a>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/integrations/actix-web">Actix Web Integration</a></li>
</ul>
</li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/config_managers">Config Managers</a></li>
</ul>
</div></aside></div></div></div><div class="h-full flex w-full" data-hk="3.21"><div data-hk="3.22" class="px-3 w-full sm:mr-auto sm:ml-auto sm:max-w-prose lg:max-w-3xl xl:max-w-4xl 2xl:max-w-5xl"><!--#--><div data-hk="3.23" class="ring-4 ring-red-400 p-4 rounded-lg mt-1"><div data-hk="3.24" class="flex flex-col 2xs:flex-row dark:text-white"><span style="fill: #f87171;" data-hk="3.25" class="self-center mr-2"><svg xmlns="http://www.w3.org/2000/svg" height="auto" viewBox="0 0 24 24" width="2.25rem" fill="\#000000"><path d="M12 7c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1s-1-.45-1-1V8c0-.55.45-1 1-1zm-.01-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm1-3h-2v-2h2v2z"/></svg></span><p data-hk="3.26">This version of the documentation is outdated, and features documented here may work differently now. You can see the latest stable version of the docs <a href="en-US/docs/0.3.x/intro" class="underline">here</a>.</p></div></div><!--/--><main class="text-black dark:text-white" data-hk="3.27"><div data-hk="2.0" class="markdown"><h1>Serving</h1>
<p><em>You only need this page if you're not using the Perseus CLI, which performs this process for you!</em></p>
<p>Having generated a large number of static files, you'll need a system to host your files for you! Due to the dynamic nature of some rendering strategies, Perseus needs to be involved in this process (for executing request-time logic), and so it provides a simple API interface for serving pages.</p>
<p>Perseus aims to be agnostic as to what framework you use to host your files, and any framework that gives you access to request headers and wildcard paths should work (in other words, any framework worth its salt).</p>
<p>If you're using one of our supported integrations, you don't have to bother with this page, nearly all of it can be done for you!</p>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/integrations/actix-web">Actix Web</a></li>
<li><em>More coming soon...</em></li>
</ul>
<h2>Endpoints</h2>
<p>Here are the endpoints that a server for Perseus must serve:</p>
<ul>
<li><code>/.perseus/page/*</code> – used to serve the JSON data that the app shell needs to render a page (<code>*</code> should be extractable as a filename, e.g. <code>{filename:.*}</code> in Actix Web)</li>
<li><code>/.perseus/bundle.js</code> – the JavaScript bundle file that calls your Wasm code (see <a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/intro">tutorial on building your first app</a>)</li>
<li><code>/.perseus/bundle.wasm</code> – the Wasm bundle file that contains your code (see <a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/tutorials/first_app/intro">tutorial on building your first app</a>)</li>
<li><code>*</code> (anything else) – any page that the user actually requests, which will return the app shell to do the heavy lifting (or more accurately an HTML file that includes the bundle)</li>
</ul>
<h2>Usage</h2>
<p>This example shows what would be done to acquire a page for any framework. You'll need to have access to these data to get a page:</p>
<ul>
<li>The page path the user requested, e.g. <code>/post/test</code> for a request to <code>/.perseus/page/post/test</code></li>
<li>Data about the HTTP request the user sent (see below)</li>
<li>A map of templates produced with <a href=""><code>get_templates_map!</code></a> (API docs WIP)</li>
<li>A <a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/config_managers">config manager</a></li>
</ul>
<pre><code class="language-rust">use perseus::{get_page};

// See below for details on this line
let http_req = convert_req(&amp;req).unwrap();

let page_data = get_page(path, http_req, &amp;render_cfg, &amp;templates, config_manager.get_ref()).await;

match page_data {
    Ok(page_data) =&gt; // Return a 200 with the stringified `page_data`
    // We parse the error to return an appropriate status code
    Err(err) =&gt; // Return the error dictated by `err_to_status_code(&amp;err)` with the body of the stringified `err`
}
</code></pre>
<h2>Request Data</h2>
<p>Perseus needs access to information about HTTP requests so it can perform tasks related to the <em>request state</em> strategy, which provides access to headers and the like. Internally, Perseus uses <a href="https://docs.rs/http/0.2.4/http/request/struct.Request.html"><code>http::Request</code></a> for this, with the body type <code>()</code> (payloads are irrelevant in requests that ask for a page at a URL).</p>
<p>Unfortunately, different web server frameworks represent request data differently, and so you'll need to convert from your framework's system to <code>http</code>'s. When integrations are ready, this will be done for you!</p>
<h3>Writing a Converter</h3>
<p>This is a simplified version of an Actix Web converter:</p>
<pre><code class="language-rust">use perseus::{HttpRequest, Request};

/// Converts an Actix Web request into an `http::request`.
pub fn convert_req(raw: &amp;actix_web::HttpRequest) -&gt; Result&lt;Request, String&gt; {
	let mut builder = HttpRequest::builder();
	// Add headers one by one
	for (name, val) in raw.headers() {
		// Each method call consumes and returns `self`, so we re-self-assign
		builder = builder.header(name, val);
	}
	// The URI to which the request was sent
	builder = builder.uri(raw.uri());
	// The method (e.g. GET, POST, etc.)
	builder = builder.method(raw.method());
	// The HTTP version used
	builder = builder.version(raw.version());

	let req = builder
		// We always use an empty body because, in a Perseus request, only the URI matters
		// Any custom data should therefore be sent in headers (if you're doing that, consider a dedicated API)
		.body(())
		.map_err(|err| format!(&quot;converting actix web request to perseus-compliant request failed: '{}'&quot;, err))?;

	Ok(req)
}
</code></pre>
<p>Notably, the data that need to be converted are:</p>
<ul>
<li>Headers</li>
<li>URI to which the request was sent</li>
<li>HTTP method (subject to change in future Perseus versions, currently <code>GET</code>)</li>
<li>HTTP version used</li>
</ul>
<p>Note that mis-converting any of these data will not affect Perseus (which doesn't require any of them to function), only your own code. So if you have no intention of using the <em>request state</em> strategy in your app, you could theoretically just parse an empty request to Perseus like so:</p>
<pre><code class="language-rust">use perseus::HttpRequest

HttpRequest::new(());
</code></pre>
<h2>File Storage</h2>
<p>Perseus' systems of storing files in production are documented in-depth <a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.1.x/config_managers">here</a>.</p>
</div></main></div></div></div></div><footer data-hk="3.28" class="w-full flex justify-center py-5 bg-gray-100 dark:bg-navy-deep"><p data-hk="3.29" class="dark:text-white mx-5 text-center"><span data-hk="3.30">© <a href="https://github.com/arctic-hen7" class="underline">arctic-hen7</a> ⁨2021⁩, see license <a href="https://github.com/arctic-hen7/perseus/blob/main/LICENSE" class="underline">here</a>.</span></p></footer><script data-hk="2.1" src=".perseus/static/prism.js" defer=""></script><script data-hk="2.2">window.Prism.highlightAll();</script></div></div>
    </body>
</html>
