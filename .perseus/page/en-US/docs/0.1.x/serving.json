{"state":"{\"title\":\"Serving\",\"content\":\"<h1>Serving</h1>\\n<p><em>You only need this page if you're not using the Perseus CLI, which performs this process for you!</em></p>\\n<p>Having generated a large number of static files, you'll need a system to host your files for you! Due to the dynamic nature of some rendering strategies, Perseus needs to be involved in this process (for executing request-time logic), and so it provides a simple API interface for serving pages.</p>\\n<p>Perseus aims to be agnostic as to what framework you use to host your files, and any framework that gives you access to request headers and wildcard paths should work (in other words, any framework worth its salt).</p>\\n<p>If you're using one of our supported integrations, you don't have to bother with this page, nearly all of it can be done for you!</p>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/integrations/actix-web\\\">Actix Web</a></li>\\n<li><em>More coming soon...</em></li>\\n</ul>\\n<h2>Endpoints</h2>\\n<p>Here are the endpoints that a server for Perseus must serve:</p>\\n<ul>\\n<li><code>/.perseus/page/*</code> – used to serve the JSON data that the app shell needs to render a page (<code>*</code> should be extractable as a filename, e.g. <code>{filename:.*}</code> in Actix Web)</li>\\n<li><code>/.perseus/bundle.js</code> – the JavaScript bundle file that calls your Wasm code (see <a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/tutorials/first_app/intro\\\">tutorial on building your first app</a>)</li>\\n<li><code>/.perseus/bundle.wasm</code> – the Wasm bundle file that contains your code (see <a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/tutorials/first_app/intro\\\">tutorial on building your first app</a>)</li>\\n<li><code>*</code> (anything else) – any page that the user actually requests, which will return the app shell to do the heavy lifting (or more accurately an HTML file that includes the bundle)</li>\\n</ul>\\n<h2>Usage</h2>\\n<p>This example shows what would be done to acquire a page for any framework. You'll need to have access to these data to get a page:</p>\\n<ul>\\n<li>The page path the user requested, e.g. <code>/post/test</code> for a request to <code>/.perseus/page/post/test</code></li>\\n<li>Data about the HTTP request the user sent (see below)</li>\\n<li>A map of templates produced with <a href=\\\"\\\"><code>get_templates_map!</code></a> (API docs WIP)</li>\\n<li>A <a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/config_managers\\\">config manager</a></li>\\n</ul>\\n<pre><code class=\\\"language-rust\\\">use perseus::{get_page};\\n\\n// See below for details on this line\\nlet http_req = convert_req(&amp;req).unwrap();\\n\\nlet page_data = get_page(path, http_req, &amp;render_cfg, &amp;templates, config_manager.get_ref()).await;\\n\\nmatch page_data {\\n    Ok(page_data) =&gt; // Return a 200 with the stringified `page_data`\\n    // We parse the error to return an appropriate status code\\n    Err(err) =&gt; // Return the error dictated by `err_to_status_code(&amp;err)` with the body of the stringified `err`\\n}\\n</code></pre>\\n<h2>Request Data</h2>\\n<p>Perseus needs access to information about HTTP requests so it can perform tasks related to the <em>request state</em> strategy, which provides access to headers and the like. Internally, Perseus uses <a href=\\\"https://docs.rs/http/0.2.4/http/request/struct.Request.html\\\"><code>http::Request</code></a> for this, with the body type <code>()</code> (payloads are irrelevant in requests that ask for a page at a URL).</p>\\n<p>Unfortunately, different web server frameworks represent request data differently, and so you'll need to convert from your framework's system to <code>http</code>'s. When integrations are ready, this will be done for you!</p>\\n<h3>Writing a Converter</h3>\\n<p>This is a simplified version of an Actix Web converter:</p>\\n<pre><code class=\\\"language-rust\\\">use perseus::{HttpRequest, Request};\\n\\n/// Converts an Actix Web request into an `http::request`.\\npub fn convert_req(raw: &amp;actix_web::HttpRequest) -&gt; Result&lt;Request, String&gt; {\\n\\tlet mut builder = HttpRequest::builder();\\n\\t// Add headers one by one\\n\\tfor (name, val) in raw.headers() {\\n\\t\\t// Each method call consumes and returns `self`, so we re-self-assign\\n\\t\\tbuilder = builder.header(name, val);\\n\\t}\\n\\t// The URI to which the request was sent\\n\\tbuilder = builder.uri(raw.uri());\\n\\t// The method (e.g. GET, POST, etc.)\\n\\tbuilder = builder.method(raw.method());\\n\\t// The HTTP version used\\n\\tbuilder = builder.version(raw.version());\\n\\n\\tlet req = builder\\n\\t\\t// We always use an empty body because, in a Perseus request, only the URI matters\\n\\t\\t// Any custom data should therefore be sent in headers (if you're doing that, consider a dedicated API)\\n\\t\\t.body(())\\n\\t\\t.map_err(|err| format!(&quot;converting actix web request to perseus-compliant request failed: '{}'&quot;, err))?;\\n\\n\\tOk(req)\\n}\\n</code></pre>\\n<p>Notably, the data that need to be converted are:</p>\\n<ul>\\n<li>Headers</li>\\n<li>URI to which the request was sent</li>\\n<li>HTTP method (subject to change in future Perseus versions, currently <code>GET</code>)</li>\\n<li>HTTP version used</li>\\n</ul>\\n<p>Note that mis-converting any of these data will not affect Perseus (which doesn't require any of them to function), only your own code. So if you have no intention of using the <em>request state</em> strategy in your app, you could theoretically just parse an empty request to Perseus like so:</p>\\n<pre><code class=\\\"language-rust\\\">use perseus::HttpRequest\\n\\nHttpRequest::new(());\\n</code></pre>\\n<h2>File Storage</h2>\\n<p>Perseus' systems of storing files in production are documented in-depth <a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/config_managers\\\">here</a>.</p>\\n\",\"sidebar_content\":\"<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/intro\\\">Introduction</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/setup\\\">Setup</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/arch\\\">Architecture</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/tutorials/first_app/intro\\\">Building Your First App</a>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/tutorials/first_app/setup\\\">Installation and Setup</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/tutorials/first_app/template\\\">Writing Your First Template</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/tutorials/first_app/app\\\">Setting up the App Itself</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/cli\\\">CLI</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/templates\\\">Templates</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/routing\\\">Routing</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/error_pages\\\">Error Pages</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/strategies/intro\\\">Rendering Strategies</a>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/strategies/build_paths\\\">Build Paths</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/strategies/build_state\\\">Build State</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/strategies/request_state\\\">Request State</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/strategies/revalidation\\\">Revalidation</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/strategies/incremental\\\">Incremental generation</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/building\\\">Building</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/serving\\\">Serving</a>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/integrations/actix-web\\\">Actix Web Integration</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.1.x/config_managers\\\">Config Managers</a></li>\\n</ul>\\n\",\"status\":\"Outdated\",\"manifest\":{\"0.1.x\":{\"state\":\"outdated\",\"git\":\"v0.1.4\",\"docs_rs\":\"0.1\"},\"0.2.x\":{\"state\":\"outdated\",\"git\":\"v0.2.3\",\"docs_rs\":\"0.2\"},\"0.3.0-0.3.3\":{\"state\":\"outdated\",\"git\":\"v0.3.3\",\"docs_rs\":\"0.3.3\"},\"0.4.x\":{\"state\":\"beta\",\"git\":\"HEAD\",\"docs_rs\":\"0.4.0-beta\"},\"0.3.4\":{\"state\":\"stable\",\"git\":\"v0.3.6\",\"docs_rs\":\"0.3\"}},\"current_version\":\"0.1.x\"}","head":"<title>Serving | Perseus Docs</title><link rel=\"stylesheet\" href=\".perseus/static/styles/markdown.css\"/><link rel=\"stylesheet\" href=\".perseus/static/styles/docs_links_markdown.css\"/><link rel=\"stylesheet\" href=\".perseus/static/prism.css\"/>"}