{"state":{"content":"<h1>Error Handling</h1>\n<p>Now we come to the error handling of our app, which is an important part of Perseus. Basically, you've got to explain to Perseus how it should cope with errors that might occur, not in your code, but in its own. For example, let's say the user's internet connection fails: whose responsibility is that? Well, your code isn't manually fetching the next page, so it will probably be Perseus' problem. However, there's a famous story about the Australian parliament that applies quite nicely here: the chambers of parliament there are color-coded, with the House of Representatives being green and the Senate red. However, all emergency exit signs in Australia must, by law, be green. This would be a bit of an antipattern in the red Senate, so a law was specially passed to allow red exit signs in the Senate only. (Yes, this really happened.)</p>\n<p>In the same manner, Perseus doesn't want to produce bright red error messages in Times New Roman if your website is bright orange in Comic Sans, so you're given full control over how to display errors. You provide <code>View</code>s to Perseus, and it renders them appropriately. For now though, we'll just do some pretty simple error handling to cover the basics: to learn more about how error handling works, and how advanced apps should handle it, see <a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/error-views\">this page</a>.</p>\n<p>First, put the following in <code>src/error_views.rs</code>:</p>\n<pre><code class=\"language-rust\">use perseus::errors::ClientError;\nuse perseus::prelude::*;\nuse sycamore::prelude::*;\n\npub fn get_error_views&lt;G: Html&gt;() -&gt; ErrorViews&lt;G&gt; {\n    ErrorViews::new(|cx, err, _err_info, _err_pos| {\n        match err {\n            ClientError::ServerError { status, message: _ } =&gt; match status {\n                404 =&gt; (\n                    view! { cx,\n                        title { &quot;Page not found&quot; }\n                    },\n                    view! { cx,\n                        p { &quot;Sorry, that page doesn't seem to exist.&quot; }\n                    },\n                ),\n                // 4xx is a client error\n                _ if (400..500).contains(&amp;status) =&gt; (\n                    view! { cx,\n                        title { &quot;Error&quot; }\n                    },\n                    view! { cx,\n                        p { &quot;There was something wrong with the last request, please try reloading the page.&quot; }\n                    },\n                ),\n                // 5xx is a server error\n                _ =&gt; (\n                    view! { cx,\n                        title { &quot;Error&quot; }\n                    },\n                    view! { cx,\n                        p { &quot;Sorry, our server experienced an internal error. Please try reloading the page.&quot; }\n                    },\n                ),\n            },\n            ClientError::Panic(_) =&gt; (\n                view! { cx,\n                    title { &quot;Critical error&quot; }\n                },\n                view! { cx,\n                    p { &quot;Sorry, but a critical internal error has occurred. This has been automatically reported to our team, who'll get on it as soon as possible. In the mean time, please try reloading the page.&quot; }\n                },\n            ),\n            ClientError::FetchError(_) =&gt; (\n                view! { cx,\n                    title { &quot;Error&quot; }\n                },\n                view! { cx,\n                    p { &quot;A network error occurred, do you have an internet connection? (If you do, try reloading the page.)&quot; }\n                },\n            ),\n            _ =&gt; (\n                view! { cx,\n                    title { &quot;Error&quot; }\n                },\n                view! { cx,\n                    p { (format!(&quot;An internal error has occurred: '{}'.&quot;, err)) }\n                },\n            ),\n        }\n    })\n}\n\n</code></pre>\n<p>This code might look intimidating, but it's actually very basic. All we're doing is defining a function <code>get_error_views()</code> that's responsible for generating our <a href=\"https://docs.rs/perseus/0.4.0-beta/perseus/prelude/struct.ErrorViews.html\"><code>ErrorViews</code></a>, which is the type that handles errors in Perseus. We provide a closure to <code>ErrorViews::new()</code> that takes four arguments: a Sycamore scope, the error itself, an <a href=\"https://docs.rs/perseus/0.4.0-beta/perseus/error_views/enum.ErrorContext.html\"><code>ErrorContext</code></a>, and an <a href=\"https://docs.rs/perseus/0.4.0-beta/perseus/error_views/enum.ErrorPosition.html\"><code>ErrorPosition</code></a>. Those last two are more complex, and you can read <a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/error-views\">this page</a> to learn more about them, but the first two are what we'll concentrate on here.</p>\n<p>The error type will always be <a href=\"https://docs.rs/perseus/0.4.0-beta/perseus/errors/enum.ClientError.html\"><code>ClientError</code></a>, which has a number of variants for all the different kinds of errors that can occur in Perseus. For now, all you need to know is that the main three are: <code>ClientError::ServerError</code>, which is used for errors that the server picked up on (e.g. a <em>404 Not Found</em>); <code>ClientError::Panic</code>, which is called just before the app terminates due to a panic; and <code>ClientError::FetchError</code>, which indicates either an internal server error or a failed network connection (usually the latter). There are several more variants, but we handle those here with a wildcard, labelling them all internal errors. With those variants explained, things are pretty self-explanatory, except perhaps for the fact that we return a tuple of two <code>Views</code>. The first one is for the document <code>&lt;head&gt;</code>, and the second is for the body.</p>\n<p>The other thing to keep in mind with error views in Perseus is that they won't always take up the whole page (and this is what <code>ErrorPosition</code> is for telling you): sometimes the content can be prerendered fine, but the client can't be initialized for whatever reason, so the user can still see content, it's just not interactive. Because it would be a bit pointless to replace perfectly good, albeit uninteractive, content with an error message, Perseus renders a less intrusive popup error, which you can style with the <code>#__perseus_popup_error</code> CSS selector. In popup errors, whatever head you render for the error will be ignored, and the original head will be kept (because the page is still perfectly good, just, again, uninteractive).</p>\n<details>\n<summary>What does uninteractive actually mean?</summary>\n<p>Great question! You can learn more about this in [the section on hydration], but it basically means that the user can see the content, because it was <em>prerendered</em> on the server-side, but they can't interact with it: e.g. if they press a button, it won't do anything. Clicking links will still work, but they'll be handled by the browser, not by Perseus.</p>\n</details>\n<p>Finally, we handle different types of <code>ClientError::ServerError</code>s differently by their [HTTP status code], which is the language HTTP (the protocol used for communicating between clients and servers) uses to describe errors. Anything starting with a 4 is a client error, and anything starting with a 5 is a server error (1 is informational, 2 is ok, and 3 indicates a redirect; you won't need to handle those). We also separately handle 404, just because it's so common.</p>\n<p>With error handling done, it's about time to run this app!</p>\n","current_version":"next","manifest":{"0.1.x":{"docs_rs":"0.1","git":"v0.1.4","state":"outdated"},"0.2.x":{"docs_rs":"0.2","git":"v0.2.3","state":"outdated"},"0.3.0-0.3.3":{"docs_rs":"0.3.3","git":"v0.3.3","state":"outdated"},"0.3.4":{"docs_rs":"0.3","git":"v0.3.6","state":"stable"},"0.4.x":{"docs_rs":"0.4.0-beta","git":"HEAD","state":"beta"}},"sidebar_content":"<h1>Introduction</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/intro\">Introduction</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/quickstart\">Quickstart</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/what-is-perseus\">What is Perseus?</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/core-principles\">Core Principles</a></li>\n</ul>\n<h1>Your First App</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/first-app/installation\">Installing Perseus</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/first-app/defining\">Defining your app</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/first-app/generating-pages\">Generating pages</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/first-app/dev-cycle\">Development cycle</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/first-app/error-handling\">Error handling</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/first-app/deploying\">Deploying your app</a></li>\n</ul>\n<h1>Fundamentals</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/perseus-app\"><code>PerseusApp</code></a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/reactor\">The reactor</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/routing\">Routing and navigation</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/preloading\">Preloading</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/i18n\">Internationalization</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/error-views\">Error views</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/hydration\">Hydration</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/static-content\">Static content</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/head-headers\">Heads and headers</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/styling\">Styling</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/js-interop\">Working with JS</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/serving-exporting\">Servers and exporting</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/debugging\">Debugging</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/testing\">Writing tests</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/plugins\">Plugins</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/compilation-times\">Improving Compilation Times</a></li>\n</ul>\n<h1>The State Platform</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/intro\">Understanding state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/build\">Build-time state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/request\">Request-time state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/revalidation\">Revalidation</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/incremental\">Incremental generation</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/amalgamation\">State amalgamation</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/browser\">Using state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/global\">Global state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/helper\">Helper state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/suspense\">Suspended state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/freezing-thawing\">Freezing and thawing</a></li>\n</ul>\n<h1>Capsules</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/capsules/intro\">Introduction</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/capsules/capsules-vs-templates\">Capsules vs. templates</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/capsules/delayed\">Delayed widgets</a></li>\n</ul>\n<h1>Miscellaneous</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/migrating\">Migrating from v0.3.x</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/faq\">Common pitfalls and FAQs</a></li>\n</ul>\n","status":"Next","title":"Error Handling"},"head":"<title>Error Handling | Perseus Docs</title><link rel=\"stylesheet\" href=\".perseus/static/styles/markdown.css\"/><link rel=\"stylesheet\" href=\".perseus/static/styles/docs_links_markdown.css\"/><link rel=\"stylesheet\" href=\".perseus/static/prism.css\"/>"}