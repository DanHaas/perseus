{"state":{"content":"<h1>Helper state</h1>\n<p>For a long time, the Perseus state platform consisted only of what you've read about so far, but there was a problem with this, one that's quite subtle. Let's say you have a blog where posts can be organized into series, and then there's a <code>series</code> template that lists each series in order. How would you write the state generation code for the series template? (Assuming it can all be done at build-time, for simplicity.)</p>\n<p>Well, you might think, we can iterate over all the blog posts in the build paths logic, and read their series metadata properties to collate a list of all the series, so that's the first part done. (Right on!) And then for the actual build state generation, you'd just need to find all the blog posts that are a part of the given series. But how can we do that?</p>\n<p>The best way is to iterate through all the blog posts again, which means, since the builds for all the series pages are done in parallel, if you have ten series, you're iterating through all those posts and reading every single one of them <em>eleven</em> times (+1 for the build paths logic). This is totally unreasonable, especially if your blog posts are on a server, rather than a local directory, and this could massively slow down build times. What would be good is if we could somehow only iterate through everything once, and just store a map of which posts are in what series that we can share through all the actual build state generations.</p>\n<p>Because the only solutions to this problem are ugly workarounds, we decided to implement this as a first-class feature in Perseus: helper state! This is what that generic on <a href=\"https://docs.rs/perseus/0.4.0-beta/perseus/prelude/struct.StateGeneratorInfo.html\"><code>StateGeneratorInfo</code></a> is all about: it denotes the type of your helper state.</p>\n<p>Importantly, helper state isn't really like any of the other state systems in Perseus, because it's not available to the views you create, and it never gets to the client: it's just a helper for the rest of your state generation. Internally, Perseus calls this <em>extra state</em>, but helper state has come to be its name outside the codebase.</p>\n<p>Here's an example of using helper/extra state:</p>\n<pre><code class=\"language-rust\">use perseus::prelude::*;\nuse serde::{Deserialize, Serialize};\nuse sycamore::prelude::*;\n\nfn index_page&lt;'a, G: Html&gt;(cx: BoundedScope&lt;'_, 'a&gt;, state: &amp;'a PageStateRx) -&gt; View&lt;G&gt; {\n    view! { cx,\n        h1 {\n            (state.title.get())\n        }\n        p {\n            (state.content.get())\n        }\n    }\n}\n\n// This is our page state, so it does have to be either reactive or unreactive\n#[derive(Serialize, Deserialize, Clone, ReactiveState)]\n#[rx(alias = &quot;PageStateRx&quot;)]\nstruct PageState {\n    title: String,\n    content: String,\n}\n\n// Notice that this doesn't need to be reactive/unreactive, since it's\n// engine-only (note that this helper state is very simple, but you could have\n// any `struct` here)\n#[derive(Serialize, Deserialize)]\nstruct HelperState(String);\n\n// In almost every other example, we use `StateGeneratorInfo&lt;()&gt;`, since that\n// type parameter is the type of your helper state! (Make sure you don't confuse\n// this with your *template* state!)\n#[engine_only_fn]\nasync fn get_build_state(info: StateGeneratorInfo&lt;HelperState&gt;) -&gt; PageState {\n    let title = format!(&quot;Path: {}&quot;, &amp;info.path);\n    let content = format!(\n        &quot;This post's original slug was '{}'. Extra state: {}&quot;,\n        &amp;title,\n        // We can't directly access `extra`, we use this function call\n        info.get_extra().0,\n    );\n\n    PageState { title, content }\n}\n\n#[engine_only_fn]\nasync fn get_build_paths() -&gt; BuildPaths {\n    BuildPaths {\n        paths: vec![\n            &quot;&quot;.to_string(),\n            &quot;test&quot;.to_string(),\n            &quot;blah/test/blah&quot;.to_string(),\n        ],\n        // Behind the scenes, Perseus converts this into the magical `TemplateState` type,\n        // which can handle *any* owned type you give it! Hence, we need to pop a `.into()`\n        // on the end of this.\n        extra: HelperState(&quot;extra helper state!&quot;.to_string()).into(),\n    }\n}\n\npub fn get_template&lt;G: Html&gt;() -&gt; Template&lt;G&gt; {\n    Template::build(&quot;index&quot;)\n        .view_with_state(index_page)\n        .build_state_fn(get_build_state)\n        .build_paths_fn(get_build_paths)\n        .build()\n}\n\n</code></pre>\n<p>Here, we've defined a special extra type called <code>HelperState</code> (but it can be called anything you like), and then we've used that for the <code>extra</code> parameter of <a href=\"https://docs.rs/perseus/0.4.0-beta/perseus/prelude/struct.BuildPaths.html\"><code>BuildPaths</code></a>. This allows the build paths function, which is executed once, to pass on useful information to the build state systems, potentially reducing the volume of computations that need to be performed. Note the use of <code>.into()</code> on the <code>HelperState</code> to convert it into a <code>Box</code>ed form that Perseus is more comfortable with internally. In fact, it's only when we call <code>.get_extra()</code> on the <a href=\"https://docs.rs/perseus/0.4.0-beta/perseus/prelude/struct.StateGeneratorinfo.html\"><code>StateGeneratorInfo</code></a> provided to the <code>get_build_state</code> function that Perseus performs the conversions necessary to retrieve our helper state type (which means specifying the generic incorrectly can lead to panics at build-time, but these would be caught before your app went live, don't worry). Finally, the <code>.0</code> is just used to access the <code>String</code> inside <code>HelperState</code>.</p>\n<p>That's pretty much all there is to helper state, and it's available at all stages of the state generation process, right up to <a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/request\">request-time state</a>. If there are any parts of request-time state that you can do at build-time, this is the best way to do them if you're not using <a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/amalgamation\">state amalgamation</a>.</p>\n","current_version":"next","manifest":{"0.1.x":{"docs_rs":"0.1","git":"v0.1.4","state":"outdated"},"0.2.x":{"docs_rs":"0.2","git":"v0.2.3","state":"outdated"},"0.3.0-0.3.3":{"docs_rs":"0.3.3","git":"v0.3.3","state":"outdated"},"0.3.4":{"docs_rs":"0.3","git":"v0.3.6","state":"stable"},"0.4.x":{"docs_rs":"0.4.0-beta","git":"HEAD","state":"beta"}},"sidebar_content":"<h1>Introduction</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/intro\">Introduction</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/quickstart\">Quickstart</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/what-is-perseus\">What is Perseus?</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/core-principles\">Core Principles</a></li>\n</ul>\n<h1>Your First App</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/first-app/installation\">Installing Perseus</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/first-app/defining\">Defining your app</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/first-app/generating-pages\">Generating pages</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/first-app/dev-cycle\">Development cycle</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/first-app/error-handling\">Error handling</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/first-app/deploying\">Deploying your app</a></li>\n</ul>\n<h1>Fundamentals</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/perseus-app\"><code>PerseusApp</code></a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/reactor\">The reactor</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/routing\">Routing and navigation</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/preloading\">Preloading</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/i18n\">Internationalization</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/error-views\">Error views</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/hydration\">Hydration</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/static-content\">Static content</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/headers\">Setting headers</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/styling\">Styling</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/js-interop\">Working with JS</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/serving-exporting\">Servers and exporting</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/debugging\">Debugging</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/testing\">Writing tests</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/plugins\">Plugins</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/compilation-times\">Improving Compilation Times</a></li>\n</ul>\n<h1>The State Platform</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/intro\">Understanding state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/build\">Build-time state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/request\">Request-time state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/revalidation\">Revalidation</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/incremental\">Incremental generation</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/amalgamation\">State amalgamation</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/browser\">Using state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/global\">Global state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/helper\">Helper state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/suspense\">Suspended state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/freezing-thawing\">Freezing and thawing</a></li>\n</ul>\n<h1>Capsules</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/capsules/intro\">Introduction</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/capsules/capsules-vs-templates\">Capsules vs. templates</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/capsules/delayed\">Delayed widgets</a></li>\n</ul>\n<h1>Miscellaneous</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/migrating\">Migrating from v0.3.x</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/faq\">Common pitfalls and FAQs</a></li>\n</ul>\n","status":"Next","title":"Helper state"},"head":"<title>Helper state | Perseus Docs</title><link rel=\"stylesheet\" href=\".perseus/static/styles/markdown.css\"/><link rel=\"stylesheet\" href=\".perseus/static/styles/docs_links_markdown.css\"/><link rel=\"stylesheet\" href=\".perseus/static/prism.css\"/>"}